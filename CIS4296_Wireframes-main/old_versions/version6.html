<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genomic Orchestra</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-dark: #212529;
            --secondary-gray: #d9d9d9;
            --accent-purple: #9b51e0;
            --bg-light: #f8f9fa;
        }

        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: white;
        }

        /* --- Navbar Styling --- */
        .navbar {
            padding: 1.5rem 2rem;
            background: white;
            transition: all 0.3s ease;
            border-bottom: 1px solid #eee; /* Added subtle separator */
        }

        .navbar-brand {
            font-size: 2rem;
            font-weight: 700;
            font-family: serif; 
            display: flex;
            align-items: center;
            position: relative;
            width: 60px;
            height: 60px;
            justify-content: center;
            cursor: pointer;
        }
        
        .dna-icon {
            font-size: 1.5rem;
            margin-left: 2px;
        }

        /* Radial Progress Bar */
        .logo-progress-container {
            position: relative;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .logo-progress-container:hover { background-color: #f0f0f0; }

        .progress-ring {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            transform: rotate(-90deg); pointer-events: none; display: none;
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s; transform-origin: 50% 50%;
            stroke: var(--accent-purple); stroke-width: 4; fill: transparent; opacity: 0.5;
        }

        .progress-ring__bg { stroke: #e0e0e0; stroke-width: 4; fill: transparent; }
        
        /* Navigation Dropdown */
        .nav-dropdown-menu {
            border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-radius: 12px; padding: 10px; width: 250px; left: 0; top: 100%;
        }
        .nav-dropdown-item {
            padding: 10px 15px; border-radius: 6px; cursor: pointer; color: #333; font-weight: 500;
            display: flex; justify-content: space-between; align-items: center; transition: all 0.2s;
        }
        .nav-dropdown-item:hover { background-color: #f8f9fa; color: var(--accent-purple); }
        .nav-dropdown-item.active-step { background-color: #f0f0f0; color: var(--accent-purple); font-weight: 700; }
        .nav-dropdown-item.disabled { color: #ccc; cursor: not-allowed; pointer-events: none; }

        .nav-link { color: #333; font-weight: 500; margin: 0 10px; cursor: pointer; }
        .user-avatar {
            width: 45px; height: 45px; border-radius: 50%; background-color: #f0f0f0;
            display: flex; align-items: center; justify-content: center; border: 2px solid #333; cursor: pointer;
        }

        /* --- Global Layout Utils --- */
        #app-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1; /* Ensures main takes remaining height */
        }

        .view-section { display: none !important; width: 100%; flex-grow: 1; flex-direction: column; }
        .view-section.active { display: flex !important; }

        /* --- Home View --- */
        .hero-section { align-items: center; text-align: center; padding-top: 3rem; position: relative; }
        .hero-title { font-size: 3.5rem; font-weight: 700; margin-bottom: 1.5rem; letter-spacing: -1px; }
        .hero-description { max-width: 800px; font-size: 1.25rem; color: #555; line-height: 1.6; margin-bottom: 4rem; padding: 0 20px; }

        .dome-container {
            width: 100%; flex-grow: 1; background-color: var(--secondary-gray);
            border-top-left-radius: 50% 100%; border-top-right-radius: 50% 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 4rem 0; position: relative; min-height: 500px; margin-top: auto;
        }

        .action-btn {
            background-color: var(--primary-dark); color: white; border: none; padding: 1.5rem; width: 350px;
            font-size: 1.1rem; border-radius: 8px; margin: 1rem 0; transition: transform 0.2s, background-color 0.2s; text-transform: capitalize;
        }
        .action-btn:hover { transform: translateY(-3px); background-color: #000; box-shadow: 0 10px 20px rgba(0,0,0,0.15); }

        /* --- Wizard Common --- */
        .wizard-container { padding: 2rem; max-width: 1200px; margin: 0 auto; width: 100%; flex-grow: 1; display: flex; flex-direction: column; }
        .wizard-header { text-align: center; margin-bottom: 2rem; }
        .wizard-title { font-size: 3rem; font-weight: 700; margin-bottom: 1rem; }
        
        .wizard-search-container {
            display: flex; justify-content: center; align-items: center; position: relative;
            margin-bottom: 2rem; gap: 20px;
        }
        .wizard-search {
            background: #e9ecef; border-radius: 30px; padding: 0.8rem 1.5rem; width: 100%;
            max-width: 400px; border: none; display: flex; align-items: center;
        }
        .wizard-search input { border: none; background: transparent; width: 100%; outline: none; margin-left: 10px; color: #555; }

        .view-toggle-btn {
            background: #e9ecef; border-radius: 30px; padding: 5px; display: flex; align-items: center; border: 1px solid #ddd;
        }
        .toggle-option {
            padding: 8px 16px; border-radius: 25px; cursor: pointer; font-size: 0.9rem; font-weight: 600;
            color: #777; transition: all 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .toggle-option.active { background-color: #7a6aa6; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .wizard-footer { width: 100%; display: flex; justify-content: space-between; margin-top: auto; padding: 2rem 0; }
        .btn-wizard {
            background-color: var(--primary-dark); color: white; padding: 0.8rem 3rem; border-radius: 6px;
            border: none; font-size: 1rem; transition: background-color 0.2s;
        }
        .btn-wizard:hover { background-color: #000; }

        /* --- Carousel & Grids --- */
        .phylogeny-carousel { display: flex; align-items: center; justify-content: center; width: 100%; position: relative; height: 450px; perspective: 1000px; }
        .phylo-card {
            width: 300px; height: 380px; background: #d9d9d9; border-radius: 10px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; position: absolute; transition: all 0.5s ease-in-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center;
        }
        .phylo-card.active { z-index: 10; transform: scale(1.1) translateX(0); background: #e0e0e0; border: 2px solid #333; opacity: 1; }
        .phylo-card.prev { z-index: 5; transform: scale(0.85) translateX(-120%); opacity: 0.6; background: #999; }
        .phylo-card.next { z-index: 5; transform: scale(0.85) translateX(120%); opacity: 0.6; background: #999; }
        .phylo-card.hidden { opacity: 0; pointer-events: none; transform: scale(0.5); z-index: 0; }
        
        .phylo-image-placeholder { width: 80%; height: 60%; border: 2px solid #555; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-top: 20px; }
        .nav-arrow { font-size: 3rem; color: #333; cursor: pointer; user-select: none; transition: transform 0.2s; position: absolute; top: 50%; transform: translateY(-50%); z-index: 20; }
        .nav-arrow:hover { transform: translateY(-50%) scale(1.1); }
        .arrow-left { left: 10%; } .arrow-right { right: 10%; }

        /* Species Grid/List */
        .species-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 2rem; width: 100%; padding: 1rem; }
        .species-card-grid { background-color: transparent; border-radius: 12px; overflow: hidden; cursor: pointer; transition: transform 0.2s; text-align: center; position: relative; }
        .species-card-grid:hover { transform: translateY(-5px); }
        .species-card-grid.selected .img-box { border-color: var(--accent-purple); box-shadow: 0 0 0 4px var(--accent-purple); }
        .species-card-grid.selected::after { content: '✓'; position: absolute; top: 10px; right: 15px; background: var(--accent-purple); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .species-card-grid .img-box { background-color: #e0e0e0; height: 200px; width: 100%; display: flex; align-items: center; justify-content: center; border-radius: 12px; border: 2px solid transparent; margin-bottom: 10px; position: relative; transition: all 0.2s; }
        .species-card-grid .img-box i { font-size: 3rem; color: #777; }
        
        .species-list-container { display: none; width: 100%; display: flex; gap: 2rem; height: 500px; }
        .list-column { flex: 1; overflow-y: auto; padding-right: 10px; }
        .preview-column { flex: 1; background: #ccc; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center; }
        .list-item { background: #e9ecef; margin-bottom: 1rem; padding: 1rem; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; transition: background 0.2s; }
        .list-item:hover { background: #dee2e6; }
        .list-item-left { display: flex; align-items: center; gap: 15px; width: 100%; cursor: pointer; }
        .custom-checkbox { width: 24px; height: 24px; background: white; border: 2px solid #999; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        .custom-checkbox.checked { background: var(--accent-purple); border-color: var(--accent-purple); }
        .custom-checkbox.checked::after { content: '✔'; color: white; font-size: 14px; }
        .btn-view-details { background: #333; color: white; border: none; padding: 0.4rem 1rem; border-radius: 4px; font-size: 0.85rem; white-space: nowrap; }
        .preview-img-large { width: 200px; height: 200px; border: 3px solid #333; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1.5rem; }

        /* Gene Styles */
        .gene-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; width: 100%; padding: 1rem; }
        .gene-card { background-color: #d9d9d9; border-radius: 50px; padding: 1.5rem; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
        .gene-card:hover { background-color: #ccc; }
        .gene-card.selected { background-color: #d0d0d0; border-color: var(--accent-purple); box-shadow: 0 0 10px rgba(155, 81, 224, 0.3); }
        .gene-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 0.5rem; }
        .gene-seq { font-family: monospace; color: #555; word-break: break-all; }
        .gene-list-container { display: none; flex-direction: column; width: 100%; padding: 0 2rem; }
        .gene-list-item { background-color: #f8f9fa; border: 1px solid #dee2e6; margin-bottom: 10px; padding: 1rem 2rem; display: flex; align-items: center; border-radius: 8px; cursor: pointer; }
        .gene-list-item:hover { background-color: #e9ecef; }
        .custom-radio { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #999; margin-right: 20px; position: relative; background: white; }
        .custom-radio.selected { border-color: var(--accent-purple); }
        .custom-radio.selected::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 14px; height: 14px; background-color: var(--accent-purple); border-radius: 50%; }
        .gene-list-name { font-size: 1.2rem; font-weight: 500; }

        /* Scale Styles */
        .scale-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 2rem; width: 100%; padding: 1rem; background-color: #ccc; border-radius: 8px; overflow-y: auto; max-height: 500px; }
        .scale-card { background-color: white; border-radius: 0; padding: 2rem; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; height: 180px; }
        .scale-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .scale-card.selected { border: 4px solid var(--accent-purple); }
        .scale-icon { font-size: 3rem; margin-bottom: 1rem; color: #333; }
        .scale-name { font-size: 1.2rem; font-weight: 500; }

        /* Config Styles */
        .config-dual-container { display: flex; gap: 2rem; width: 100%; justify-content: center; }
        .config-panel { background-color: #ccc; padding: 2rem; border-radius: 8px; flex: 1; max-width: 500px; }
        .config-panel h3 { text-align: center; margin-bottom: 1.5rem; font-weight: 700; }
        .config-row { background-color: #eee; margin-bottom: 1rem; padding: 1rem; display: flex; align-items: center; justify-content: space-between; border-radius: 4px; }
        .config-label { font-size: 1.1rem; font-weight: 500; }
        .config-select { padding: 0.4rem 1rem; border-radius: 4px; border: 1px solid #aaa; background-color: #ddd; width: 140px; }

        /* Summary Page Styles */
        .summary-container-list { display: flex; flex-direction: column; gap: 1.5rem; width: 100%; padding: 0 2rem; overflow-y: auto; max-height: 550px; }
        .summary-card { background-color: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 1.5rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .summary-card:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.08); }
        .summary-content h4 { font-size: 1.25rem; margin-bottom: 0.5rem; color: var(--primary-dark); font-weight: 700; }
        .summary-content p { margin: 0; color: #666; font-size: 1rem; }
        
        .btn-edit { background-color: transparent; color: #777; border: 1px solid #ccc; padding: 0.5rem 1.5rem; border-radius: 6px; transition: all 0.2s; height: 40px;}
        .btn-edit:hover { background-color: var(--primary-dark); color: white; border-color: var(--primary-dark); }
        .btn-edit-square { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; background: #333; color: white; border-radius: 8px; border: none; font-size: 0.9rem; }
        .btn-edit-square:hover { background: #000; }

        .summary-container-visual { display: none; flex-direction: column; width: 100%; gap: 2rem; max-height: 550px; overflow-y: auto; }
        .summary-visual-section { width: 100%; background-color: transparent; padding: 1rem 0; border-bottom: 1px solid #eee; }
        .summary-visual-row { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .summary-section-title { font-size: 1.5rem; font-weight: 700; width: 200px; }
        .summary-items-grid { display: flex; gap: 1rem; flex-wrap: wrap; flex: 1; margin: 0 2rem; align-items: center; }
        .species-card-mini { width: 120px; height: 100px; background: #bbb; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #555; }
        .species-card-mini .img-box-mini { font-size: 1.5rem; color: #555; margin-bottom: 5px; }
        .species-card-mini span { font-size: 0.8rem; font-weight: 600; color: #333; }
        .config-pill { background-color: #d9d9d9; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.9rem; font-weight: 500; color: #333; min-width: 120px; text-align: center; display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .config-pill-circle { background: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; }

        /* --- PLAYER VIEW STYLES --- */
        .player-container {
            display: flex;
            width: 100%;
            flex-grow: 1;
            height: 100%;
            overflow: hidden; /* Sidebar scroll handled internally */
        }

        .player-sidebar {
            width: 280px;
            background-color: #d9d9d9;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-right: 1px solid #ccc;
            height: 100%; /* Fills the height of the container */
            flex-shrink: 0;
            justify-content: center; /* Center buttons vertically or top */
        }

        .player-btn {
            width: 100%;
            background-color: var(--primary-dark);
            color: white;
            border: none;
            padding: 1.2rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .player-btn:hover {
            background-color: #000;
            transform: translateY(-2px);
        }

        .player-content {
            flex-grow: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
            background-color: #f8f9fa;
        }

        .track-row {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .track-info {
            width: 150px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .track-img {
            width: 80px;
            height: 60px;
            background-color: #aaa;
            border-radius: 6px;
            border: 2px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .track-clef {
            font-size: 2.5rem;
            color: #555;
        }

        .track-timeline {
            flex-grow: 1;
            height: 80px;
            background-color: #eee;
            border-radius: 6px;
            margin-left: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .track-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: repeating-linear-gradient(
                0deg,
                #ccc,
                #ccc 1px,
                transparent 1px,
                transparent 16px
            );
            pointer-events: none;
        }

        /* Fake Notes */
        .note-block {
            position: absolute;
            height: 12px;
            width: 30px;
            background-color: #666;
            border-radius: 4px;
            transition: background-color 0.1s;
        }
        
        .note-block.playing {
            background-color: var(--accent-purple);
            box-shadow: 0 0 10px var(--accent-purple);
            border: 1px solid white;
        }

        /* Playhead */
        .playhead {
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background-color: red;
            z-index: 100;
            pointer-events: none;
            display: none; 
        }
        
        .playhead::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -6px;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 10px solid red;
        }

        footer { background-color: #999; color: white; padding: 1.5rem; text-align: center; font-size: 0.9rem; z-index: 10; }

    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg" id="mainNavbar">
        <div class="container-fluid">
             <div class="dropdown">
                 <div class="logo-progress-container" id="navDropdownTrigger" data-bs-toggle="dropdown" aria-expanded="false">
                    <svg class="progress-ring" width="70" height="70" id="progressRing">
                        <circle class="progress-ring__bg" stroke-dasharray="200" stroke-dashoffset="0" cx="35" cy="35" r="30" />
                        <circle class="progress-ring__circle" stroke-dasharray="200" stroke-dashoffset="200" cx="35" cy="35" r="30" id="progressCircle" />
                    </svg>
                    <a class="navbar-brand m-0" href="#">G<i class="fa-solid fa-dna dna-icon"></i></a>
                 </div>
                 <ul class="dropdown-menu nav-dropdown-menu" id="navDropdownMenu" aria-labelledby="navDropdownTrigger"></ul>
             </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-center" id="navLinksContainer">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" onclick="navigateTo('home')">Link</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="navigateTo('home')">Link</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="navigateTo('home')">Link</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="navigateTo('home')">Link</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="navigateTo('home')">Link</a></li>
                </ul>
            </div>

            <div class="user-avatar ms-auto">
                <i class="fa-solid fa-user-doctor text-dark"></i>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="app-container">
        
        <!-- ... Previous Views (Home, Step 1-6) ... -->
        <!-- HOME -->
        <div id="view-home" class="view-section active hero-section">
            <h1 class="hero-title">Genomic Orchestra</h1>
            <p class="hero-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis ac bibendum libero.</p>
            <div class="dome-container">
                <button class="action-btn" onclick="navigateTo('create-step-1')">Create your Symphony</button>
                <button class="action-btn" onclick="navigateTo('load')">Load Symphonies</button>
            </div>
        </div>
        <!-- S1: PHYLO -->
        <div id="view-create-step-1" class="view-section wizard-container">
            <div class="wizard-header"><h2 class="wizard-title">Phylogeny</h2><p class="text-muted">Select the base phylogeny.</p></div>
            <div class="wizard-search-container"><div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Hinted search text"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div></div>
            <div class="phylogeny-carousel">
                <i class="fa-solid fa-arrow-left nav-arrow arrow-left" onclick="moveCarousel(-1)"></i>
                <div id="card-container" style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;"></div>
                <i class="fa-solid fa-arrow-right nav-arrow arrow-right" onclick="moveCarousel(1)"></i>
            </div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('home')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-2')">Next</button></div>
        </div>
        <!-- S2: SPECIES -->
        <div id="view-create-step-2" class="view-section wizard-container">
            <div class="wizard-header"><h2 class="wizard-title">Species</h2><p class="text-muted">Select one or multiple species.</p></div>
            <div class="wizard-search-container">
                <div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Hinted search text"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div>
                <div class="view-toggle-btn">
                    <div class="toggle-option active" id="toggle-cards-s2" onclick="toggleSpeciesView('cards')"><i class="fa-solid fa-grip"></i> Cards</div>
                    <div class="toggle-option" id="toggle-lists-s2" onclick="toggleSpeciesView('lists')"><i class="fa-solid fa-list"></i> Lists</div>
                </div>
            </div>
            <div id="species-grid" class="species-grid-container"></div>
            <div id="species-list" class="species-list-container" style="display: none;">
                <div class="list-column" id="species-list-items"></div>
                <div class="preview-column"><div class="preview-img-large"><i class="fa-regular fa-image fa-4x text-secondary"></i></div><h3 id="preview-title">Select a Species</h3></div>
            </div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-1')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-3')">Next</button></div>
        </div>
        <!-- S3: GENES -->
        <div id="view-create-step-3" class="view-section wizard-container">
            <div class="wizard-header"><h2 class="wizard-title">Genes</h2><p class="text-muted">Select a gene sequence.</p></div>
            <div class="wizard-search-container">
                <div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Hinted search text"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div>
                <div class="view-toggle-btn">
                    <div class="toggle-option active" id="toggle-cards-s3" onclick="toggleGeneView('cards')"><i class="fa-solid fa-grip"></i> Cards</div>
                    <div class="toggle-option" id="toggle-lists-s3" onclick="toggleGeneView('lists')"><i class="fa-solid fa-list"></i> Lists</div>
                </div>
            </div>
            <div id="gene-grid" class="gene-grid-container"></div>
            <div id="gene-list" class="gene-list-container"></div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-2')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-4')">Next</button></div>
        </div>
        <!-- S4: SCALE -->
        <div id="view-create-step-4" class="view-section wizard-container">
            <div class="wizard-header"><h2 class="wizard-title">Configurations (Scale)</h2></div>
            <div class="wizard-search-container"><h3 class="me-3 mb-0" style="font-weight: 700;">Key Scale</h3><div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Search Key Scale"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div></div>
            <div class="scale-grid-container" id="scale-grid"></div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-3')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-5')">Next</button></div>
        </div>
        <!-- S5: CONFIG -->
        <div id="view-create-step-5" class="view-section wizard-container">
            <div class="wizard-header"><h2 class="wizard-title">Configurations</h2></div>
            <div class="config-dual-container">
                <div class="config-panel"><h3>Nucleotides</h3><div id="nucleotide-container"></div></div>
                <div class="config-panel"><h3>Amino Acids</h3><div id="amino-container"></div></div>
            </div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-4')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-6')">Next</button></div>
        </div>
        <!-- S6: SUMMARY -->
        <div id="view-create-step-6" class="view-section wizard-container">
            <div class="wizard-header"><h2 class="wizard-title">Symphony</h2></div>
            <div class="wizard-search-container" style="justify-content: flex-end;">
                 <div class="view-toggle-btn">
                    <div class="toggle-option active" id="toggle-sum-list" onclick="toggleSummaryView('list')"><i class="fa-solid fa-list"></i> List</div>
                    <div class="toggle-option" id="toggle-sum-visual" onclick="toggleSummaryView('visual')"><i class="fa-solid fa-grip"></i> Visual</div>
                </div>
            </div>
            <div class="summary-container-list" id="summary-content-list"></div>
            <div class="summary-container-visual" id="summary-content-visual"></div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-5')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-7')">Create Symphony</button></div>
        </div>
        
        <!-- === STEP 7: PLAYER (UPDATED LAYOUT) === -->
        <div id="view-create-step-7" class="view-section player-container">
            <!-- Sidebar (Full Height Left) -->
            <div class="player-sidebar">
                <button class="player-btn" onclick="togglePlay()"><i class="fa-solid fa-play me-2" id="playIcon"></i> <span id="playText">Play Symphony</span></button>
                <button class="player-btn" onclick="navigateTo('create-step-6')"><i class="fa-solid fa-pen-to-square"></i> Edit Symphony</button>
                <button class="player-btn" onclick="alert('Symphony Saved!')"><i class="fa-solid fa-floppy-disk"></i> Save Symphony</button>
                <button class="player-btn" onclick="navigateTo('load')"><i class="fa-solid fa-folder-open"></i> Load Symphonies</button>
            </div>
            
            <!-- Tracks Area (Right Side) -->
            <div class="player-content" id="player-tracks-container">
                <!-- Playhead -->
                <div class="playhead" id="playhead"></div>
                
                <!-- Generated Tracks -->
                <div id="tracks-wrapper" style="width: 100%;"></div>
            </div>
        </div>

        <!-- LOAD VIEW -->
        <div id="view-load" class="view-section align-items-center justify-content-center" style="flex-grow:1; background: #f8f9fa;">
            <div class="text-center"><h2>Load Symphonies Interface</h2><button class="btn btn-secondary mt-3" onclick="navigateTo('home')">Back Home</button></div>
        </div>

    </main>

    <!-- Footer -->
    <footer>Footer Content HERE</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- State ---
        let currentStep = 0; let maxStepReached = 0; const totalSteps = 7; 
        
        // Data
        const phylogenies = [ { id: 1, title: 'Phylogeny 1' }, { id: 2, title: 'Phylogeny 2' }, { id: 3, title: 'Phylogeny 3' }, { id: 4, title: 'Phylogeny 4' }, { id: 5, title: 'Phylogeny 5' } ];
        let currentCardIndex = 0;
        const speciesData = [ { id: 1, name: 'Species 1' }, { id: 2, name: 'Species 2' }, { id: 3, name: 'Species 3' }, { id: 4, name: 'Species 4' }, { id: 5, name: 'Species 5' }, { id: 6, name: 'Species 6' }, { id: 7, name: 'Species 7' }, { id: 8, name: 'Species 8' } ];
        let selectedSpeciesIds = [];
        const genesData = [ { id: 1, name: 'Gene 1', seq: '[ ATG ] [ CGA ] [ TAC ] [ AGG ] [ GTC ]' }, { id: 2, name: 'Gene 2', seq: '[ GGC ] [ ATC ] [ GGG ] [ TTA ] [ CGC ]' }, { id: 3, name: 'Gene 3', seq: '[ TTT ] [ AAA ] [ CCC ] [ GGG ] [ TAC ]' }, { id: 4, name: 'Gene 4', seq: '[ CTA ] [ GCT ] [ AGT ] [ CGT ] [ TGA ]' }, { id: 5, name: 'Gene 5', seq: '[ ATG ] [ CGA ] [ TAC ] [ AGG ] [ GTC ]' }, { id: 6, name: 'Gene 6', seq: '[ GGC ] [ ATC ] [ GGG ] [ TTA ] [ CGC ]' } ];
        let selectedGeneId = null;
        const scalesData = [ { id: 'C', name: 'C Major' }, { id: 'G', name: 'G Major' }, { id: 'D', name: 'D Major' }, { id: 'A', name: 'A Major' }, { id: 'E', name: 'E Major' }, { id: 'B', name: 'B Major' }, { id: 'F', name: 'F Major' }, { id: 'Bb', name: 'Bb Major' } ];
        let selectedScaleId = null;
        const nucleotides = ['Adenine', 'Thymine', 'Guanine', 'Cytosine'];
        const aminoAcids = ['Polar', 'NonPolar', 'Acidic', 'Basic'];
        let configState = { nucleotides: { Adenine: 'Note 1', Thymine: 'Note 1', Guanine: 'Note 1', Cytosine: 'Note 1' }, aminoAcids: { Polar: 'Chord 1', NonPolar: 'Chord 1', Acidic: 'Chord 1', Basic: 'Chord 1' } };

        // Player Animation State
        let isPlaying = false;
        let animationFrame;
        let progress = 0;

        // --- Navigation ---
        function navigateTo(viewId) {
            document.querySelectorAll('.view-section').forEach(el => { el.classList.remove('active'); });
            const target = document.getElementById(`view-${viewId}`);
            if (target) target.classList.add('active');

            const progressRing = document.getElementById('progressRing');
            const navLinks = document.getElementById('navLinksContainer');
            const mainNavbar = document.getElementById('mainNavbar');

            // Logic for Step 7 (Player) - Keep Navbar visible
            if (viewId === 'home') {
                currentStep = 0; progressRing.style.display = 'none'; if(navLinks) navLinks.style.opacity = '1';
            } else if (viewId.startsWith('create-step')) {
                const stepNum = parseInt(viewId.split('-').pop());
                currentStep = stepNum;
                if (currentStep > maxStepReached) maxStepReached = currentStep;

                progressRing.style.display = 'block';
                updateProgress(currentStep, totalSteps);
                if(navLinks) navLinks.style.opacity = '0'; 

                if (currentStep === 1) renderCarousel();
                if (currentStep === 2) renderSpecies();
                if (currentStep === 3) renderGenes();
                if (currentStep === 4) renderScales();
                if (currentStep === 5) renderConfig();
                if (currentStep === 6) renderSummary();
                if (currentStep === 7) renderPlayer(); 

            } else if (viewId === 'load') {
                currentStep = 0; progressRing.style.display = 'none';
            }
            updateNavigationDropdown();
        }

        // ... [Standard Functions] ...
        function updateNavigationDropdown() {
            const menu = document.getElementById('navDropdownMenu');
            menu.innerHTML = `<li class="nav-dropdown-item ${currentStep === 0 ? 'active-step' : ''}" onclick="navigateTo('home')"><span>Home</span> <i class="fa-solid fa-house"></i></li>`;
            const steps = [ { num: 1, name: 'Phylogeny' }, { num: 2, name: 'Species' }, { num: 3, name: 'Genes' }, { num: 4, name: 'Scale' }, { num: 5, name: 'Config' }, { num: 6, name: 'Summary' }, { num: 7, name: 'Player' } ];
            steps.forEach(s => {
                const isActive = (currentStep === s.num); const isAccessible = (s.num <= maxStepReached);
                let itemClass = 'nav-dropdown-item'; if (isActive) itemClass += ' active-step'; if (!isAccessible) itemClass += ' disabled';
                const onClick = isAccessible ? `onclick="navigateTo('create-step-${s.num}')"` : '';
                const icon = isActive ? '<i class="fa-solid fa-location-dot"></i>' : (isAccessible ? '<i class="fa-solid fa-check text-success"></i>' : '<i class="fa-solid fa-lock"></i>');
                menu.innerHTML += `<li class="${itemClass}" ${onClick}><span>${s.name}</span>${icon}</li>`;
            });
        }
        function updateProgress(step, total) { const circle = document.getElementById('progressCircle'); const radius = circle.r.baseVal.value; const circumference = radius * 2 * Math.PI; circle.style.strokeDasharray = `${circumference} ${circumference}`; circle.style.strokeDashoffset = circumference - ((step / total) * circumference); }
        function renderCarousel() { const container = document.getElementById('card-container'); container.innerHTML = ''; phylogenies.forEach((phylo, index) => { const card = document.createElement('div'); card.className = `phylo-card ${getCardClass(index)}`; card.innerHTML = `<h3>${phylo.title}</h3><div class="phylo-image-placeholder"><i class="fa-regular fa-image fa-3x text-secondary"></i></div>`; container.appendChild(card); }); }
        function getCardClass(index) { if (index === currentCardIndex) return 'active'; if (index === currentCardIndex - 1) return 'prev'; if (index === currentCardIndex + 1) return 'next'; return 'hidden'; }
        function moveCarousel(dir) { const next = currentCardIndex + dir; if (next >= 0 && next < phylogenies.length) { currentCardIndex = next; renderCarousel(); } }
        function toggleSpeciesView(type) { const grid = document.getElementById('species-grid'); const list = document.getElementById('species-list'); const btnCards = document.getElementById('toggle-cards-s2'); const btnLists = document.getElementById('toggle-lists-s2'); if (type === 'cards') { grid.style.display = 'grid'; list.style.display = 'none'; btnCards.classList.add('active'); btnLists.classList.remove('active'); } else { grid.style.display = 'none'; list.style.display = 'flex'; btnCards.classList.remove('active'); btnLists.classList.add('active'); } }
        function renderSpecies() { document.getElementById('species-grid').innerHTML = speciesData.map(s => { const isSelected = selectedSpeciesIds.includes(s.id); return `<div class="species-card-grid ${isSelected ? 'selected' : ''}" onclick="toggleSpeciesSelection(${s.id})"><div class="img-box"><i class="fa-regular fa-image"></i></div><h5>${s.name}</h5></div>` }).join(''); document.getElementById('species-list-items').innerHTML = speciesData.map(s => { const isSelected = selectedSpeciesIds.includes(s.id); return `<div class="list-item"><div class="list-item-left" onclick="toggleSpeciesSelection(${s.id})"><div class="custom-checkbox ${isSelected ? 'checked' : ''}"></div><h5 class="m-0">${s.name}</h5></div><button class="btn-view-details">View Details</button></div>` }).join(''); }
        function toggleSpeciesSelection(id) { if (selectedSpeciesIds.includes(id)) selectedSpeciesIds = selectedSpeciesIds.filter(itemId => itemId !== id); else selectedSpeciesIds.push(id); renderSpecies(); }
        function toggleGeneView(type) { const grid = document.getElementById('gene-grid'); const list = document.getElementById('gene-list'); const btnCards = document.getElementById('toggle-cards-s3'); const btnLists = document.getElementById('toggle-lists-s3'); if (type === 'cards') { grid.style.display = 'grid'; list.style.display = 'none'; btnCards.classList.add('active'); btnLists.classList.remove('active'); } else { grid.style.display = 'none'; list.style.display = 'flex'; btnCards.classList.remove('active'); btnLists.classList.add('active'); } }
        function renderGenes() { document.getElementById('gene-grid').innerHTML = genesData.map(g => { const isSelected = (selectedGeneId === g.id); return `<div class="gene-card ${isSelected ? 'selected' : ''}" onclick="selectGene(${g.id})"><div class="gene-title">${g.name}</div><div class="gene-seq">${g.seq}</div></div>`; }).join(''); document.getElementById('gene-list').innerHTML = genesData.map(g => { const isSelected = (selectedGeneId === g.id); return `<div class="gene-list-item" onclick="selectGene(${g.id})"><div class="custom-radio ${isSelected ? 'selected' : ''}"></div><div class="gene-list-name">${g.name}</div></div>`; }).join(''); }
        function selectGene(id) { selectedGeneId = id; renderGenes(); }
        function renderScales() { document.getElementById('scale-grid').innerHTML = scalesData.map(scale => { const isSelected = (selectedScaleId === scale.id); return `<div class="scale-card ${isSelected ? 'selected' : ''}" onclick="selectScale('${scale.id}')"><i class="fa-solid fa-music scale-icon"></i><div class="scale-name">${scale.name}</div></div>`; }).join(''); }
        function selectScale(id) { selectedScaleId = id; renderScales(); }
        function renderConfig() { document.getElementById('nucleotide-container').innerHTML = nucleotides.map(n => ` <div class="config-row"> <span class="config-label">${n}</span> <select class="config-select" onchange="configState.nucleotides['${n}'] = this.value"> <option value="Note 1" ${configState.nucleotides[n] === 'Note 1' ? 'selected' : ''}>Note 1</option> <option value="Note 2" ${configState.nucleotides[n] === 'Note 2' ? 'selected' : ''}>Note 2</option> <option value="Note 3" ${configState.nucleotides[n] === 'Note 3' ? 'selected' : ''}>Note 3</option> </select> </div> `).join(''); document.getElementById('amino-container').innerHTML = aminoAcids.map(a => ` <div class="config-row"> <span class="config-label">${a}</span> <select class="config-select" onchange="configState.aminoAcids['${a}'] = this.value"> <option value="Chord 1" ${configState.aminoAcids[a] === 'Chord 1' ? 'selected' : ''}>Chord 1</option> <option value="Chord 2" ${configState.aminoAcids[a] === 'Chord 2' ? 'selected' : ''}>Chord 2</option> <option value="Chord 3" ${configState.aminoAcids[a] === 'Chord 3' ? 'selected' : ''}>Chord 3</option> </select> </div> `).join(''); }
        function toggleSummaryView(type) { const listContainer = document.getElementById('summary-content-list'); const visualContainer = document.getElementById('summary-content-visual'); const btnList = document.getElementById('toggle-sum-list'); const btnVisual = document.getElementById('toggle-sum-visual'); if (type === 'list') { listContainer.style.display = 'flex'; visualContainer.style.display = 'none'; btnList.classList.add('active'); btnVisual.classList.remove('active'); } else { listContainer.style.display = 'none'; visualContainer.style.display = 'flex'; btnList.classList.remove('active'); btnVisual.classList.add('active'); } }
        function renderSummary() { 
            const phyloName = phylogenies[currentCardIndex].title; const selectedSpecies = selectedSpeciesIds.length > 0 ? speciesData.filter(s => selectedSpeciesIds.includes(s.id)) : []; const speciesNames = selectedSpecies.map(s => s.name).join(', ') || 'None selected'; const geneObj = genesData.find(g => g.id === selectedGeneId); const geneName = geneObj ? geneObj.name : 'None selected'; const scaleObj = scalesData.find(s => s.id === selectedScaleId); const scaleName = scaleObj ? scaleObj.name : 'None selected';
            document.getElementById('summary-content-list').innerHTML = ` <div class="summary-card"><div class="summary-content"><h4>Phylogeny</h4><p>${phyloName}</p></div><button class="btn-edit" onclick="navigateTo('create-step-1')">Edit</button></div> <div class="summary-card"><div class="summary-content"><h4>Species</h4><p>${speciesNames}</p></div><button class="btn-edit" onclick="navigateTo('create-step-2')">Edit</button></div> <div class="summary-card"><div class="summary-content"><h4>Gene</h4><p>${geneName}</p></div><button class="btn-edit" onclick="navigateTo('create-step-3')">Edit</button></div> <div class="summary-card"><div class="summary-content"><h4>Configuration</h4><p>Scale: ${scaleName}</p><p style="font-size:0.85rem; color:#888;">Nuc/Amino configured</p></div><button class="btn-edit" onclick="navigateTo('create-step-4')">Edit</button></div> `;
            let speciesHTML = selectedSpecies.length > 0 ? selectedSpecies.map(s => ` <div class="species-card-mini"> <div class="img-box-mini"><i class="fa-regular fa-image"></i></div> <span>${s.name}</span> </div> `).join('') : '<span class="text-muted">No Species</span>';
            let nucPills = Object.entries(configState.nucleotides).map(([base, note]) => ` <div class="config-pill"><div class="config-pill-circle">N</div> ${base} - ${note}</div> `).join('');
            let aminoPills = Object.entries(configState.aminoAcids).map(([type, chord]) => ` <div class="config-pill"><div class="config-pill-circle">A</div> ${type} - ${chord}</div> `).join('');
            document.getElementById('summary-content-visual').innerHTML = ` <div class="summary-visual-section"> <div class="summary-visual-row"> <div class="summary-section-title">${phyloName}</div> <div class="summary-items-grid"> ${speciesHTML} </div> <button class="btn-edit-square" onclick="navigateTo('create-step-1')">Edit</button> </div> </div> <div class="summary-visual-section" style="border-bottom:none;"> <div class="summary-visual-row"> <div class="summary-section-title">${geneName}</div> <div class="summary-items-grid"> ${nucPills} ${aminoPills} </div> <button class="btn-edit-square" onclick="navigateTo('create-step-5')">Edit</button> </div> </div> `;
        }


        // --- PLAYER LOGIC ---
        function renderPlayer() {
            const wrapper = document.getElementById('tracks-wrapper');
            wrapper.innerHTML = '';
            
            // Filter valid species
            const selectedSpecies = speciesData.filter(s => selectedSpeciesIds.includes(s.id));
            
            if (selectedSpecies.length === 0) {
                wrapper.innerHTML = '<p class="text-center text-muted">No species selected to play.</p>';
                return;
            }

            // Create tracks
            selectedSpecies.forEach((species, index) => {
                let notesHTML = '';
                for(let i = 0; i < 15; i++) {
                    const leftPos = Math.random() * 90;
                    const width = 5 + Math.random() * 10;
                    const topPos = 10 + Math.random() * 50; 
                    notesHTML += `<div class="note-block" style="left: ${leftPos}%; width: ${width}%; top: ${topPos}px;"></div>`;
                }

                wrapper.innerHTML += `
                <div class="track-row">
                    <div class="track-info">
                        <div class="track-img"><i class="fa-regular fa-image text-white"></i></div>
                        <div class="track-clef">&#119070;</div>
                    </div>
                    <div class="track-timeline">
                        <div class="track-lines"></div>
                        ${notesHTML}
                    </div>
                </div>
                `;
            });
            stopAnimation();
        }

        function togglePlay() {
            if (isPlaying) { stopAnimation(); } else { startAnimation(); }
        }

        function startAnimation() {
            isPlaying = true;
            document.getElementById('playIcon').className = 'fa-solid fa-pause me-2';
            document.getElementById('playText').innerText = 'Pause Symphony';
            
            const playhead = document.getElementById('playhead');
            playhead.style.display = 'block';

            function animate() {
                if (!isPlaying) return;
                progress += 0.2; 
                if (progress > 100) progress = 0;
                
                // Animate playhead across container width (simplification)
                const containerWidth = document.getElementById('player-tracks-container').offsetWidth;
                const trackStart = 20; // Padding
                const timelineWidth = containerWidth - 40;
                
                // Just use percentage for visual simplicity in this demo context
                playhead.style.left = `${progress}%`;
                
                // Highlight Notes logic
                document.querySelectorAll('.note-block').forEach(note => {
                    const noteLeftPerc = parseFloat(note.style.left);
                    const noteWidthPerc = parseFloat(note.style.width);
                    if (progress >= noteLeftPerc && progress <= (noteLeftPerc + noteWidthPerc)) {
                        note.classList.add('playing');
                    } else {
                        note.classList.remove('playing');
                    }
                });
                animationFrame = requestAnimationFrame(animate);
            }
            animate();
        }

        function stopAnimation() {
            isPlaying = false;
            cancelAnimationFrame(animationFrame);
            document.getElementById('playIcon').className = 'fa-solid fa-play me-2';
            document.getElementById('playText').innerText = 'Play Symphony';
            document.querySelectorAll('.note-block').forEach(n => n.classList.remove('playing'));
        }

        // Init
        renderSpecies(); renderGenes();
    </script>
</body>
</html>