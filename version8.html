<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genomic Orchestra 2025 | Advanced Bioinformatics Research Platform | NCBI/Ensembl Integration</title>
    <meta name="description" content="Professional bioinformatics research platform (2025) for converting genomic sequences into musical compositions. Research-grade tool with NCBI, Ensembl, and UCSC Genome Browser integration. Designed for computational biologists, genomics researchers, and academic institutions.">
    <meta name="keywords" content="bioinformatics, genomics, computational biology, NCBI, Ensembl, genome sequencing, musical genomics, research platform 2025">
    <meta name="author" content="Genomic Orchestra Research Team">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-dark: #1a1d29;
            --secondary-gray: #e8eaf6;
            --accent-purple: #7c3aed;
            --accent-teal: #14b8a6;
            --bg-light: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        /* --- Navbar Styling --- */
        .navbar {
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(124, 58, 237, 0.1);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .navbar-brand {
            font-size: 2rem;
            font-weight: 700;
            font-family: serif; 
            display: flex;
            align-items: center;
            position: relative;
            width: 60px;
            height: 60px;
            justify-content: center;
            cursor: pointer;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .dna-icon {
            font-size: 1.5rem;
            margin-left: 2px;
            color: var(--accent-purple);
        }

        /* Radial Progress Bar */
        .logo-progress-container {
            position: relative;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .logo-progress-container:hover { background-color: rgba(124, 58, 237, 0.1); }

        .progress-ring {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            transform: rotate(-90deg); pointer-events: none; display: none;
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s; transform-origin: 50% 50%;
            stroke: var(--accent-purple); stroke-width: 4; fill: transparent; opacity: 0.8;
        }

        .progress-ring__bg { stroke: #e0e7ff; stroke-width: 4; fill: transparent; }
        
        /* Navigation Dropdown */
        .nav-dropdown-menu {
            border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-radius: 12px; padding: 10px; width: 250px; left: 0; top: 100%;
            background: white;
        }
        .nav-dropdown-item {
            padding: 10px 15px; border-radius: 6px; cursor: pointer; color: #333; font-weight: 500;
            display: flex; justify-content: space-between; align-items: center; transition: all 0.2s;
        }
        .nav-dropdown-item:hover { background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(20, 184, 166, 0.1) 100%); color: var(--accent-purple); }
        .nav-dropdown-item.active-step { background: var(--primary-gradient); color: white; font-weight: 700; }
        .nav-dropdown-item.disabled { color: #ccc; cursor: not-allowed; pointer-events: none; }

        .nav-link { color: var(--text-primary); font-weight: 500; margin: 0 10px; cursor: pointer; transition: color 0.2s; }
        .nav-link:hover { color: var(--accent-purple); }
        .user-avatar {
            width: 45px; height: 45px; border-radius: 50%; background: var(--primary-gradient);
            display: flex; align-items: center; justify-content: center; border: 2px solid var(--accent-purple); cursor: pointer;
            transition: transform 0.2s;
        }
        .user-avatar:hover { transform: scale(1.1); }

        /* --- Login View --- */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 200px);
            padding: 2rem;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .login-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }
        
        .research-badge {
            display: inline-block;
            background: var(--primary-gradient);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .data-badge {
            display: inline-block;
            background: var(--accent-teal);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .info-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(124, 58, 237, 0.1);
            color: var(--accent-purple);
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .phylo-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 10px;
            font-size: 0.8rem;
        }
        
        .phylo-stat-item {
            background: white;
            padding: 0.5rem;
            border-radius: 6px;
            text-align: center;
        }
        
        .phylo-stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .phylo-stat-value {
            font-weight: 700;
            color: var(--accent-purple);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-control {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 0.75rem 1rem;
            transition: all 0.2s;
        }

        .form-control:focus {
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .btn-login {
            width: 100%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 1rem;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(124, 58, 237, 0.3);
            color: white;
        }

        .login-footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-secondary);
        }

        /* --- Global Layout Utils --- */
        #app-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .view-section { display: none !important; width: 100%; flex-grow: 1; flex-direction: column; }
        .view-section.active { display: flex !important; }

        /* --- Home View --- */
        .hero-section { align-items: center; text-align: center; padding-top: 3rem; position: relative; }
        .hero-title { 
            font-size: 3.5rem; font-weight: 700; margin-bottom: 1.5rem; letter-spacing: -1px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hero-description { 
            max-width: 900px; 
            font-size: 1.15rem; 
            color: var(--text-secondary); 
            line-height: 1.8; 
            margin-bottom: 4rem; 
            padding: 0 20px;
            text-align: justify;
        }
        
        .hero-features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .hero-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        .hero-feature i {
            color: var(--accent-purple);
        }

        .dome-container {
            width: 100%; flex-grow: 1; background: var(--primary-gradient);
            border-top-left-radius: 50% 100%; border-top-right-radius: 50% 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 4rem 0; position: relative; min-height: 500px; margin-top: auto;
        }

        .action-btn {
            background: white; color: var(--accent-purple); border: none; padding: 1.5rem; width: 350px;
            font-size: 1.1rem; border-radius: 12px; margin: 1rem 0; transition: all 0.3s; text-transform: capitalize;
            font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .action-btn:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3); color: var(--accent-purple); }

        /* --- Wizard Common --- */
        .wizard-container { padding: 2rem; max-width: 1200px; margin: 0 auto; width: 100%; flex-grow: 1; display: flex; flex-direction: column; }
        .wizard-header { text-align: center; margin-bottom: 2rem; }
        .wizard-title { 
            font-size: 2.75rem; font-weight: 700; margin-bottom: 0.75rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .wizard-header p.text-muted {
            font-size: 1rem;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .wizard-search-container {
            display: flex; justify-content: center; align-items: center; position: relative;
            margin-bottom: 2rem; gap: 20px;
        }
        .wizard-search {
            background: white; border-radius: 30px; padding: 0.8rem 1.5rem; width: 100%;
            max-width: 400px; border: 2px solid #e2e8f0; display: flex; align-items: center;
            transition: all 0.2s;
        }
        .wizard-search:focus-within { border-color: var(--accent-purple); box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); }
        .wizard-search input { border: none; background: transparent; width: 100%; outline: none; margin-left: 10px; color: var(--text-primary); }

        .view-toggle-btn {
            background: white; border-radius: 30px; padding: 5px; display: flex; align-items: center; border: 2px solid #e2e8f0;
        }
        .toggle-option {
            padding: 8px 16px; border-radius: 25px; cursor: pointer; font-size: 0.9rem; font-weight: 600;
            color: var(--text-secondary); transition: all 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .toggle-option.active { background: var(--primary-gradient); color: white; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3); }

        .wizard-footer { width: 100%; display: flex; justify-content: space-between; margin-top: auto; padding: 2rem 0; }
        .btn-wizard {
            background: var(--primary-gradient); color: white; padding: 0.8rem 3rem; border-radius: 10px;
            border: none; font-size: 1rem; transition: all 0.2s; font-weight: 600;
        }
        .btn-wizard:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3); color: white; }

        /* --- Carousel & Grids --- */
        .phylogeny-carousel { display: flex; align-items: center; justify-content: center; width: 100%; position: relative; height: 520px; perspective: 1000px; }
        .phylo-card {
            width: 380px; height: 480px; background: white; border-radius: 15px; display: flex; flex-direction: column;
            align-items: center; justify-content: flex-start; position: absolute; transition: all 0.5s ease-in-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; padding: 1.75rem;
        }
        .phylo-card.active { z-index: 10; transform: scale(1.1) translateX(0); background: white; border: 3px solid var(--accent-purple); opacity: 1; box-shadow: 0 15px 40px rgba(124, 58, 237, 0.2); }
        .phylo-card.prev { z-index: 5; transform: scale(0.85) translateX(-120%); opacity: 0.6; background: #f1f5f9; }
        .phylo-card.next { z-index: 5; transform: scale(0.85) translateX(120%); opacity: 0.6; background: #f1f5f9; }
        .phylo-card.hidden { opacity: 0; pointer-events: none; transform: scale(0.5); z-index: 0; }
        
        .phylo-image-placeholder { width: 85%; height: 45%; border: 2px solid var(--accent-purple); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-top: 15px; background: var(--secondary-gray); }
        .nav-arrow { font-size: 3rem; color: var(--accent-purple); cursor: pointer; user-select: none; transition: transform 0.2s; position: absolute; top: 50%; transform: translateY(-50%); z-index: 20; }
        .nav-arrow:hover { transform: translateY(-50%) scale(1.2); }
        .arrow-left { left: 10%; } .arrow-right { right: 10%; }

        /* Species Grid/List */
        .species-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 2rem; width: 100%; padding: 1rem; }
        .species-card-grid { background-color: transparent; border-radius: 15px; overflow: hidden; cursor: pointer; transition: transform 0.2s; text-align: center; position: relative; }
        .species-card-grid:hover { transform: translateY(-5px); }
        .species-card-grid.selected .img-box { border-color: var(--accent-purple); box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.2); }
        .species-card-grid.selected::after { content: 'âœ“'; position: absolute; top: 10px; right: 15px; background: var(--accent-purple); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3); }
        .species-card-grid .img-box { background: var(--primary-gradient); height: 200px; width: 100%; display: flex; align-items: center; justify-content: center; border-radius: 12px; border: 2px solid transparent; margin-bottom: 10px; position: relative; transition: all 0.2s; }
        .species-card-grid .img-box i { font-size: 3rem; color: white; }
        
        .species-list-container { display: none; width: 100%; display: flex; gap: 2rem; height: 500px; }
        .list-column { flex: 1; overflow-y: auto; padding-right: 10px; }
        .preview-column { flex: 1; background: white; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .list-item { background: white; margin-bottom: 1rem; padding: 1rem; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .list-item:hover { background: var(--secondary-gray); transform: translateX(5px); }
        .list-item-left { display: flex; align-items: center; gap: 15px; width: 100%; cursor: pointer; }
        .custom-checkbox { width: 24px; height: 24px; background: white; border: 2px solid #cbd5e1; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; transition: all 0.2s; }
        .custom-checkbox.checked { background: var(--accent-purple); border-color: var(--accent-purple); }
        .custom-checkbox.checked::after { content: 'âœ”'; color: white; font-size: 14px; }
        .btn-view-details { background: var(--primary-gradient); color: white; border: none; padding: 0.5rem 1.2rem; border-radius: 8px; font-size: 0.85rem; white-space: nowrap; transition: all 0.2s; font-weight: 600; }
        .btn-view-details:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); color: white; }
        .preview-img-large { width: 200px; height: 200px; border: 3px solid var(--accent-purple); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 1.5rem; background: var(--primary-gradient); }

        /* Species Details Modal */
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .modal-header {
            background: var(--primary-gradient);
            color: white;
            border-radius: 20px 20px 0 0;
            border: none;
            padding: 1.5rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .species-detail-item {
            margin-bottom: 1.5rem;
            padding: 1.25rem;
            background: var(--bg-light);
            border-radius: 10px;
            border-left: 4px solid var(--accent-purple);
        }

        .species-detail-label {
            font-weight: 600;
            color: var(--accent-purple);
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
        
        .species-detail-item div:last-child {
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .species-detail-item a {
            color: var(--accent-purple);
            text-decoration: none;
            font-weight: 600;
        }
        
        .species-detail-item a:hover {
            text-decoration: underline;
        }

        /* Gene Styles */
        .gene-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; width: 100%; padding: 1rem; }
        .gene-card { background: white; border-radius: 15px; padding: 1.75rem; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .gene-card:hover { background: var(--secondary-gray); transform: translateY(-3px); }
        .gene-card.selected { background: white; border-color: var(--accent-purple); box-shadow: 0 0 20px rgba(124, 58, 237, 0.3); }
        .gene-title { font-weight: 700; font-size: 1.2rem; margin-bottom: 0.75rem; color: var(--text-primary); }
        .gene-seq { font-family: 'Courier New', monospace; color: var(--text-secondary); word-break: break-all; font-size: 0.9rem; background: var(--bg-light); padding: 0.5rem; border-radius: 6px; margin: 0.5rem 0; }
        .gene-list-container { display: none; flex-direction: column; width: 100%; padding: 0 2rem; }
        .gene-list-item { background: white; border: 1px solid #e2e8f0; margin-bottom: 10px; padding: 1.25rem 2rem; display: flex; align-items: center; border-radius: 12px; cursor: pointer; transition: all 0.2s; }
        .gene-list-item:hover { background: var(--secondary-gray); transform: translateX(5px); }
        .custom-radio { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #cbd5e1; margin-right: 20px; position: relative; background: white; transition: all 0.2s; }
        .custom-radio.selected { border-color: var(--accent-purple); }
        .custom-radio.selected::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 14px; height: 14px; background: var(--accent-purple); border-radius: 50%; }
        .gene-list-name { font-size: 1.3rem; font-weight: 600; color: var(--text-primary); }

        /* Scale Styles */
        .scale-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 2rem; width: 100%; padding: 1rem; background: white; border-radius: 15px; overflow-y: auto; max-height: 500px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .scale-card { background: var(--secondary-gray); border-radius: 12px; padding: 2rem; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; height: 200px; position: relative; }
        
        .scale-card::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 8px;
            height: 8px;
            background: var(--accent-teal);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .scale-card.selected::before {
            opacity: 1;
        }
        .scale-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(124, 58, 237, 0.2); }
        .scale-card.selected { border: 4px solid var(--accent-purple); background: white; }
        .scale-icon { font-size: 3rem; margin-bottom: 1rem; color: var(--accent-purple); }
        .scale-name { font-size: 1.2rem; font-weight: 500; color: var(--text-primary); }

        /* Config Styles */
        .config-dual-container { display: flex; gap: 2rem; width: 100%; justify-content: center; }
        .config-panel { background: white; padding: 2rem; border-radius: 15px; flex: 1; max-width: 500px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .config-panel h3 { 
            text-align: center; 
            margin-bottom: 1.5rem; 
            font-weight: 700; 
            color: var(--accent-purple);
            font-size: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--accent-purple);
        }
        .config-row { 
            background: var(--bg-light); 
            margin-bottom: 1rem; 
            padding: 1.25rem; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            border-radius: 10px;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .config-row:hover {
            border-left-color: var(--accent-purple);
            background: white;
        }
        .config-label { font-size: 1.1rem; font-weight: 500; color: var(--text-primary); }
        .config-select { 
            padding: 0.6rem 1rem; 
            border-radius: 8px; 
            border: 2px solid #e2e8f0; 
            background-color: white; 
            width: 160px; 
            transition: all 0.2s;
            font-weight: 500;
            cursor: pointer;
        }
        .config-select:focus { border-color: var(--accent-purple); outline: none; box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); }

        /* Summary Page Styles */
        .summary-container-list { display: flex; flex-direction: column; gap: 1.5rem; width: 100%; padding: 0 2rem; overflow-y: auto; max-height: 550px; }
        .summary-card { background: white; border: 1px solid #e2e8f0; border-radius: 15px; padding: 1.5rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: all 0.2s; }
        .summary-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(124, 58, 237, 0.1); }
        .summary-content h4 { font-size: 1.25rem; margin-bottom: 0.5rem; color: var(--accent-purple); font-weight: 700; }
        .summary-content p { margin: 0; color: var(--text-secondary); font-size: 1rem; }
        
        .btn-edit { background: white; color: var(--accent-purple); border: 2px solid var(--accent-purple); padding: 0.5rem 1.5rem; border-radius: 8px; transition: all 0.2s; height: 40px; font-weight: 600;}
        .btn-edit:hover { background: var(--primary-gradient); color: white; border-color: transparent; }
        .btn-edit-square { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; background: var(--primary-gradient); color: white; border-radius: 12px; border: none; font-size: 0.9rem; transition: all 0.2s; }
        .btn-edit-square:hover { transform: scale(1.1); box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3); }

        .summary-container-visual { display: none; flex-direction: column; width: 100%; gap: 2rem; max-height: 550px; overflow-y: auto; }
        .summary-visual-section { width: 100%; background-color: transparent; padding: 1rem 0; border-bottom: 1px solid #e2e8f0; }
        .summary-visual-row { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .summary-section-title { font-size: 1.5rem; font-weight: 700; width: 200px; color: var(--accent-purple); }
        .summary-items-grid { display: flex; gap: 1rem; flex-wrap: wrap; flex: 1; margin: 0 2rem; align-items: center; }
        .species-card-mini { width: 120px; height: 100px; background: var(--primary-gradient); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid var(--accent-purple); }
        .species-card-mini .img-box-mini { font-size: 1.5rem; color: white; margin-bottom: 5px; }
        .species-card-mini span { font-size: 0.8rem; font-weight: 600; color: white; }
        .config-pill { background: white; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; font-weight: 500; color: var(--text-primary); min-width: 120px; text-align: center; display: flex; justify-content: space-between; align-items: center; gap: 10px; border: 2px solid #e2e8f0; }
        .config-pill-circle { background: var(--accent-purple); color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; }

        /* --- PLAYER VIEW STYLES --- */
        .player-container {
            display: flex;
            width: 100%;
            flex-grow: 1;
            height: 100%;
            overflow: hidden;
        }

        .player-sidebar {
            width: 280px;
            background: white;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-right: 1px solid #e2e8f0;
            height: 100%;
            flex-shrink: 0;
            justify-content: center;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }

        .player-btn {
            width: 100%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 1.2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
        }

        .player-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(124, 58, 237, 0.3);
            color: white;
        }

        .player-content {
            flex-grow: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
            background: var(--bg-light);
        }

        .track-row {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--accent-purple);
        }

        .track-info {
            width: 200px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .track-img {
            width: 80px;
            height: 60px;
            background: var(--primary-gradient);
            border-radius: 8px;
            border: 2px solid var(--accent-purple);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .track-clef {
            font-size: 2.5rem;
            color: var(--accent-purple);
        }

        .track-timeline {
            flex-grow: 1;
            height: 80px;
            background: white;
            border-radius: 8px;
            margin-left: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            border: 2px solid #e2e8f0;
        }

        .track-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: repeating-linear-gradient(
                0deg,
                #cbd5e1,
                #cbd5e1 1px,
                transparent 1px,
                transparent 16px
            );
            pointer-events: none;
        }

        .note-block {
            position: absolute;
            height: 12px;
            width: 30px;
            background: var(--accent-purple);
            border-radius: 4px;
            transition: all 0.1s;
        }
        
        .note-block.playing {
            background: var(--accent-teal);
            box-shadow: 0 0 15px var(--accent-teal);
            border: 1px solid white;
            transform: scale(1.2);
        }

        .playhead {
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--error);
            z-index: 100;
            pointer-events: none;
            display: none; 
        }
        
        .playhead::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -6px;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 10px solid var(--error);
        }

        /* Load Symphonies View */
        .load-container {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .symphony-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: all 0.2s;
            cursor: pointer;
            border-left: 4px solid var(--accent-purple);
        }

        .symphony-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.15);
        }

        .symphony-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .symphony-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-purple);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .symphony-title::before {
            content: 'ðŸŽµ';
            font-size: 1.5rem;
            opacity: 0.8;
        }

        .symphony-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .symphony-info {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .symphony-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            background: var(--bg-light);
            border-radius: 8px;
        }

        .symphony-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-symphony {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-load {
            background: var(--primary-gradient);
            color: white;
        }
        
        .btn-load:hover {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-delete {
            background: var(--error);
            color: white;
        }

        .btn-symphony:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 5rem;
            color: var(--accent-purple);
            margin-bottom: 1.5rem;
            opacity: 0.6;
        }
        
        .empty-state h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .empty-state p {
            max-width: 600px;
            margin: 0 auto 1.5rem;
            line-height: 1.6;
        }

        footer { 
            background: linear-gradient(135deg, #1a1d29 0%, #2d1b3d 100%); 
            color: white; 
            padding: 2.5rem 1.5rem; 
            text-align: center; 
            font-size: 0.9rem; 
            z-index: 10;
            border-top: 1px solid rgba(124, 58, 237, 0.3);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.2s;
            font-size: 0.85rem;
        }
        
        .footer-link:hover {
            color: white;
        }
        
        .footer-copyright {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            margin-top: 1rem;
        }
        
        .research-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(124, 58, 237, 0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            border: 1px solid rgba(124, 58, 237, 0.3);
            margin: 0.25rem;
        }
        
        .phylo-stats {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .phylo-stat-item {
            text-align: center;
            padding: 0.5rem;
            background: rgba(124, 58, 237, 0.05);
            border-radius: 8px;
            min-width: 70px;
        }
        
        .phylo-stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .phylo-stat-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-purple);
            margin-top: 0.25rem;
        }
        
        .research-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .research-badge-large {
            background: var(--primary-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .data-source {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 0.5rem;
        }
        
        .gene-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .gene-detail-item {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 8px;
            border-left: 3px solid var(--accent-purple);
        }
        
        .gene-detail-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .gene-detail-value {
            font-size: 0.95rem;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .info-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            background: rgba(124, 58, 237, 0.1);
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--accent-purple);
            font-weight: 600;
            border: 1px solid rgba(124, 58, 237, 0.2);
        }
        
        .data-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            background: var(--success);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .hero-features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }
        
        .hero-feature {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.2s;
        }
        
        .hero-feature:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.15);
        }
        
        .hero-feature i {
            color: var(--accent-purple);
            font-size: 1.2rem;
        }
        
        .hero-feature span {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        footer p {
            margin: 0.25rem 0;
        }
        
        .footer-links {
            margin-top: 0.5rem;
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        
        .footer-links a:hover {
            opacity: 1;
            text-decoration: underline;
        }

        /* Team Modal/Popup Styles */
        .team-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(26, 29, 41, 0.95) 0%, rgba(45, 27, 61, 0.95) 100%);
            backdrop-filter: blur(10px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 1;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            overflow-y: auto;
        }

        .team-modal-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .team-modal-content {
            background: white;
            border-radius: 30px;
            max-width: 1400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0,0,0,0.3);
            position: relative;
            animation: modalSlideIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .team-modal-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2.5rem 3rem;
            border-radius: 30px 30px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .team-modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .team-modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg) scale(1.1);
        }

        .team-modal-body {
            padding: 3rem;
        }

        /* Team Section Styles */
        .team-section {
            padding: 2rem 0;
            background: transparent;
            position: relative;
            overflow: hidden;
        }

        .team-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-purple), transparent);
        }

        .team-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .team-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.75rem;
        }

        .team-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .team-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .team-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .team-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 40px rgba(124, 58, 237, 0.2);
            border-color: var(--accent-purple);
        }

        .team-card:hover::before {
            transform: scaleX(1);
        }

        .team-image-container {
            width: 140px;
            height: 140px;
            margin: 0 auto 1.25rem;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            border: 4px solid var(--accent-purple);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.3);
            transition: all 0.4s ease;
        }

        .team-card:hover .team-image-container {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 12px 35px rgba(124, 58, 237, 0.4);
        }

        .team-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center 25%;
            transition: transform 0.4s ease;
        }

        .team-card:hover .team-image {
            transform: scale(1.15);
        }

        .team-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            transition: color 0.3s ease;
        }

        .team-card:hover .team-name {
            color: var(--accent-purple);
        }

        .team-role {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .team-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.95) 0%, rgba(20, 184, 166, 0.95) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease;
            border-radius: 20px;
        }

        .team-card:hover .team-overlay {
            opacity: 1;
        }

        .team-overlay-content {
            text-align: center;
            color: white;
            padding: 1.5rem;
        }

        .team-overlay-content i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }

        .team-overlay-content h4 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .team-overlay-content p {
            font-size: 0.95rem;
            opacity: 0.95;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Team Grid */
        @media (max-width: 768px) {
            .team-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1.5rem;
            }
            
            .team-image-container {
                width: 120px;
                height: 120px;
            }
            
            .team-title {
                font-size: 2rem;
            }
        }

        /* Instrument Assignment Styles */
        .instrument-assignment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            width: 100%;
            padding: 1rem;
        }

        .instrument-assignment-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .instrument-assignment-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.15);
        }

        .instrument-species-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--bg-light);
        }

        .instrument-species-icon {
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--accent-purple);
        }

        .instrument-species-icon i {
            font-size: 1.5rem;
            color: white;
        }

        .instrument-species-info h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .instrument-species-info p {
            margin: 0.25rem 0 0 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .instrument-select-container {
            position: relative;
        }

        .instrument-select-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            display: block;
            font-size: 0.95rem;
        }

        .instrument-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .instrument-option {
            background: var(--bg-light);
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
        }

        .instrument-option:hover {
            background: white;
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .instrument-option.selected {
            background: var(--primary-gradient);
            border-color: var(--accent-purple);
            color: white;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .instrument-option i {
            font-size: 1.5rem;
            color: var(--accent-purple);
        }

        .instrument-option.selected i {
            color: white;
        }

        .instrument-option span {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .instrument-option.selected span {
            color: white;
        }

        .track-instrument-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary-gradient);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .track-instrument-badge i {
            font-size: 1rem;
        }

    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg" id="mainNavbar">
        <div class="container-fluid">
             <div class="dropdown">
                 <div class="logo-progress-container" id="navDropdownTrigger" data-bs-toggle="dropdown" aria-expanded="false">
                    <svg class="progress-ring" width="70" height="70" id="progressRing">
                        <circle class="progress-ring__bg" stroke-dasharray="200" stroke-dashoffset="0" cx="35" cy="35" r="30" />
                        <circle class="progress-ring__circle" stroke-dasharray="200" stroke-dashoffset="200" cx="35" cy="35" r="30" id="progressCircle" />
                    </svg>
                    <a class="navbar-brand m-0" href="#" onclick="navigateTo('home')">G<i class="fa-solid fa-dna dna-icon"></i></a>
                 </div>
                 <ul class="dropdown-menu nav-dropdown-menu" id="navDropdownMenu" aria-labelledby="navDropdownTrigger"></ul>
             </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-center" id="navLinksContainer">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" onclick="navigateTo('home')">Home</a></li>
                    <li class="nav-item"><a class="nav-link" onclick="navigateTo('create-step-1')">Create</a></li>
                    <li class="nav-item"><a class="nav-link" id="navSavedLink" onclick="navigateTo('load')">Saved</a></li>
                    <li class="nav-item"><a class="nav-link" id="navProfile" onclick="showProfileMenu()" style="display: none;">Profile</a></li>
                </ul>
            </div>

            <div class="user-avatar ms-auto" id="userAvatar" onclick="showProfileMenu()" style="display: none;">
                <i class="fa-solid fa-user-doctor text-white"></i>
            </div>
            <button class="btn btn-outline-primary ms-auto" id="loginBtn" onclick="navigateTo('login')">Login</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="app-container">
        
        <!-- LOGIN VIEW -->
        <div id="view-login" class="view-section active login-container">
            <div class="login-card">
                <h1 class="login-title">Research Portal <span class="research-badge">2025</span></h1>
                <p class="login-subtitle">Access your genomic composition projects and research data. Secure authentication for academic and research institutions.</p>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="loginEmail" placeholder="your.email@example.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn-login">
                        <i class="fa-solid fa-sign-in-alt me-2"></i> Sign In
                    </button>
                </form>
                <div class="login-footer">
                    <p style="font-size: 0.85rem;">Demo Mode: Use any email/password to login</p>
                    <p style="font-size: 0.75rem; margin-top: 0.5rem; color: var(--text-secondary);">
                        <i class="fa-solid fa-shield-alt me-1"></i> Secure Research Platform | 
                        <i class="fa-solid fa-database me-1"></i> NCBI/Ensembl Integration | 
                        <i class="fa-solid fa-flask me-1"></i> Academic License
                    </p>
                </div>
            </div>
        </div>
        
        <!-- HOME -->
        <div id="view-home" class="view-section hero-section" style="display: none;">
            <h1 class="hero-title">Genomic Orchestra <span class="research-badge" style="font-size: 1.5rem; padding: 0.5rem 1rem;">2025</span></h1>
            <p class="hero-description">Advanced bioinformatics research platform for converting genomic sequences into musical compositions. Leveraging state-of-the-art algorithms to translate nucleotide sequences, gene expression patterns, and phylogenetic relationships into harmonious musical representations. Designed for researchers, educators, and computational biologists exploring the intersection of genomics and computational musicology.</p>
            <div class="hero-features">
                <div class="hero-feature">
                    <i class="fa-solid fa-database"></i>
                    <span>NCBI/Ensembl Integration</span>
                </div>
                <div class="hero-feature">
                    <i class="fa-solid fa-flask"></i>
                    <span>Research-Grade Algorithms</span>
                </div>
                <div class="hero-feature">
                    <i class="fa-solid fa-shield-alt"></i>
                    <span>Secure Data Management</span>
                </div>
                <div class="hero-feature">
                    <i class="fa-solid fa-chart-line"></i>
                    <span>Advanced Visualization</span>
                </div>
            </div>
            <div class="dome-container">
                <button class="action-btn" onclick="navigateTo('create-step-1')">
                    <i class="fa-solid fa-music me-2"></i>Create your Symphony
                </button>
                <button class="action-btn" onclick="navigateTo('load')" style="opacity: 0.7;">
                    <i class="fa-solid fa-folder-open me-2"></i>Load Saved Symphonies
                    <span style="display: block; font-size: 0.75rem; margin-top: 0.25rem; opacity: 0.9;">(Login required)</span>
                </button>
            </div>
            
            <!-- Team Section (on homepage) -->
            <div class="team-section" style="display: none;">
                <div class="team-header">
                    <h2 class="team-title">Our Research Team</h2>
                    <p class="team-subtitle">Meet the talented developers and researchers behind Genomic Orchestra 2025</p>
                </div>
                <div class="team-grid" id="team-grid-home">
                    <!-- Team members will be rendered here -->
                </div>
            </div>
        </div>
        <!-- S1: PHYLO -->
        <div id="view-create-step-1" class="view-section wizard-container" style="display: none;">
            <div class="wizard-header">
                <h2 class="wizard-title">Step 1: Choose a Species Group</h2>
                <p class="text-muted">Select a group of related species (like mammals, birds, or plants). Each group contains species with similar DNA that will create harmonious music together. <span style="font-size: 0.85rem; color: var(--text-secondary);">(For researchers: Select taxonomic framework with NCBI Taxonomy data)</span></p>
            </div>
            <div class="wizard-search-container"><div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Search phylogenies..." id="phyloSearch"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div></div>
            <div class="phylogeny-carousel">
                <i class="fa-solid fa-arrow-left nav-arrow arrow-left" onclick="moveCarousel(-1)"></i>
                <div id="card-container" style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;"></div>
                <i class="fa-solid fa-arrow-right nav-arrow arrow-right" onclick="moveCarousel(1)"></i>
            </div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('home')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-2')">Next</button></div>
        </div>
        <!-- S2: SPECIES -->
        <div id="view-create-step-2" class="view-section wizard-container" style="display: none;">
            <div class="wizard-header">
                <h2 class="wizard-title">Step 2: Select Species</h2>
                <p class="text-muted">Choose one or more species to include in your composition. Each species will play its DNA sequence as music. You can select multiple species to hear how their DNA compares. <span style="font-size: 0.85rem; color: var(--text-secondary);">(For researchers: Includes genomic annotations from NCBI, Ensembl, UCSC)</span></p>
            </div>
            <div class="wizard-search-container">
                <div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Search species..." id="speciesSearch"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div>
                <div class="view-toggle-btn">
                    <div class="toggle-option active" id="toggle-cards-s2" onclick="toggleSpeciesView('cards')"><i class="fa-solid fa-grip"></i> Cards</div>
                    <div class="toggle-option" id="toggle-lists-s2" onclick="toggleSpeciesView('lists')"><i class="fa-solid fa-list"></i> Lists</div>
                </div>
            </div>
            <div id="species-grid" class="species-grid-container"></div>
            <div id="species-list" class="species-list-container" style="display: none;">
                <div class="list-column" id="species-list-items"></div>
                <div class="preview-column"><div class="preview-img-large"><i class="fa-regular fa-image fa-4x text-white"></i></div><h3 id="preview-title">Select a Species</h3><p class="text-muted">Click "View Details" to see more information</p></div>
            </div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-1')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-3')">Next</button></div>
        </div>
        <!-- S3: INSTRUMENTS -->
        <div id="view-create-step-3" class="view-section wizard-container" style="display: none;">
            <div class="wizard-header">
                <h2 class="wizard-title">Step 3: Choose Instruments</h2>
                <p class="text-muted">Pick one or more instruments for each species. Each species will play its DNA music using the instruments you choose. You can select multiple instruments per species to create richer, layered sounds. <span style="font-size: 0.85rem; color: var(--text-secondary);">(Tip: Different instruments help distinguish between species in the final composition)</span></p>
            </div>
            <div class="wizard-search-container">
                <div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Search instruments..." id="instrumentSearch"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div>
            </div>
            <div id="instrument-assignment-container" style="width: 100%; padding: 1rem;"></div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-2')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-4')">Next</button></div>
        </div>
        <!-- S4: GENES -->
        <div id="view-create-step-4" class="view-section wizard-container" style="display: none;">
            <div class="wizard-header">
                <h2 class="wizard-title">Step 4: Select a Gene</h2>
                <p class="text-muted">Choose a gene (a section of DNA that codes for a protein). This gene's DNA sequence will be converted into musical notes. Each gene has a unique sequence that creates different musical patterns. <span style="font-size: 0.85rem; color: var(--text-secondary);">(For researchers: Protein-coding genes with NCBI annotations and chromosome locations)</span></p>
            </div>
            <div class="wizard-search-container">
                <div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Search genes..." id="geneSearch"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div>
                <div class="view-toggle-btn">
                    <div class="toggle-option active" id="toggle-cards-s3" onclick="toggleGeneView('cards')"><i class="fa-solid fa-grip"></i> Cards</div>
                    <div class="toggle-option" id="toggle-lists-s3" onclick="toggleGeneView('lists')"><i class="fa-solid fa-list"></i> Lists</div>
                </div>
            </div>
            <div id="gene-grid" class="gene-grid-container"></div>
            <div id="gene-list" class="gene-list-container"></div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-3')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-5')">Next</button></div>
        </div>
        <!-- S5: SCALE -->
        <div id="view-create-step-5" class="view-section wizard-container" style="display: none;">
            <div class="wizard-header">
                <h2 class="wizard-title">Step 5: Choose Musical Key</h2>
                <p class="text-muted">Select the musical key (like C Major or G Major) for your composition. This determines which notes will be used and how the music will sound. Different keys create different moods and harmonies. <span style="font-size: 0.85rem; color: var(--text-secondary);">(For musicians: Standard major scale keys available)</span></p>
            </div>
            <div class="wizard-search-container"><h3 class="me-3 mb-0" style="font-weight: 700; color: var(--accent-purple);">Key Scale</h3><div class="wizard-search"><i class="fa-solid fa-bars text-secondary me-2"></i><input type="text" placeholder="Search scales..." id="scaleSearch"><i class="fa-solid fa-magnifying-glass text-secondary"></i></div></div>
            <div class="scale-grid-container" id="scale-grid"></div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-4')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-6')">Next</button></div>
        </div>
        <!-- S6: CONFIG -->
        <div id="view-create-step-6" class="view-section wizard-container" style="display: none;">
            <div class="wizard-header">
                <h2 class="wizard-title">Step 6: DNA-to-Music Settings</h2>
                <p class="text-muted">Customize how DNA letters (A, T, G, C) are converted to musical notes. You can map each DNA letter to a different note, and adjust how proteins create chords. <span style="font-size: 0.85rem; color: var(--text-secondary);">(For researchers: Advanced nucleotide-to-note and amino acid-to-chord mapping algorithms)</span></p>
            </div>
            <div class="config-dual-container">
                <div class="config-panel"><h3>Nucleotides</h3><div id="nucleotide-container"></div></div>
                <div class="config-panel"><h3>Amino Acids</h3><div id="amino-container"></div></div>
            </div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-5')">Back</button><button class="btn-wizard" onclick="navigateTo('create-step-7')">Next</button></div>
        </div>
        <!-- S7: SUMMARY -->
        <div id="view-create-step-7" class="view-section wizard-container" style="display: none;">
            <div class="wizard-header">
                <h2 class="wizard-title">Step 7: Review Your Composition</h2>
                <p class="text-muted">Review all your choices before creating your symphony. Check that you've selected species, instruments, a gene, and musical settings. You can go back to edit any step if needed.</p>
            </div>
            <div class="wizard-search-container" style="justify-content: flex-end;">
                 <div class="view-toggle-btn">
                    <div class="toggle-option active" id="toggle-sum-list" onclick="toggleSummaryView('list')"><i class="fa-solid fa-list"></i> List</div>
                    <div class="toggle-option" id="toggle-sum-visual" onclick="toggleSummaryView('visual')"><i class="fa-solid fa-grip"></i> Visual</div>
                </div>
            </div>
            <div class="summary-container-list" id="summary-content-list"></div>
            <div class="summary-container-visual" id="summary-content-visual"></div>
            <div class="wizard-footer"><button class="btn-wizard" onclick="navigateTo('create-step-6')">Back</button><button class="btn-wizard" onclick="saveAndNavigateToPlayer()">Create Symphony</button></div>
        </div>
        
        <!-- === STEP 8: PLAYER === -->
        <div id="view-create-step-8" class="view-section player-container" style="display: none;">
            <div class="player-sidebar">
                <button class="player-btn" onclick="togglePlay()"><i class="fa-solid fa-play me-2" id="playIcon"></i> <span id="playText">Play Symphony</span></button>
                <button class="player-btn" onclick="navigateTo('create-step-7')"><i class="fa-solid fa-pen-to-square"></i> Edit Symphony</button>
                <button class="player-btn" id="saveSymphonyBtn" onclick="saveSymphony()">
                    <i class="fa-solid fa-floppy-disk"></i> Save for Analysis
                    <span id="saveSymphonyNote" style="display: none; font-size: 0.7rem; margin-top: 0.25rem;">(Login required)</span>
                </button>
                <button class="player-btn" id="loadSymphonyBtn" onclick="navigateTo('load')">
                    <i class="fa-solid fa-folder-open"></i> Saved Compositions
                    <span id="loadSymphonyNote" style="display: none; font-size: 0.7rem; margin-top: 0.25rem;">(Login required)</span>
                </button>
                <button class="player-btn" onclick="navigateTo('home')" style="background: var(--bg-light); color: var(--accent-purple); border: 2px solid var(--accent-purple);">
                    <i class="fa-solid fa-home"></i> Back to Home
                </button>
            </div>
            <div class="player-content" id="player-tracks-container">
                <div class="playhead" id="playhead"></div>
                <div id="tracks-wrapper" style="width: 100%;"></div>
            </div>
        </div>

        <!-- LOAD VIEW -->
        <div id="view-load" class="view-section load-container" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div>
                    <h2 class="wizard-title mb-1">Saved Compositions</h2>
                    <p class="text-muted">Access your saved compositions for analysis and research</p>
                </div>
                <button class="btn-wizard" onclick="navigateTo('create-step-1')">
                    <i class="fa-solid fa-plus me-2"></i>Create New
                </button>
            </div>
            <div id="symphonies-list"></div>
        </div>

    </main>

    <!-- Team Modal Popup -->
    <div id="teamModal" class="team-modal-overlay" onclick="if(event.target === this) closeTeamModal()">
        <div class="team-modal-content" onclick="event.stopPropagation()">
            <div class="team-modal-header">
                <button class="team-modal-close" onclick="closeTeamModal()" aria-label="Close">
                    <i class="fa-solid fa-times"></i>
                </button>
                <div class="team-header" style="text-align: center; margin-bottom: 0;">
                    <h2 class="team-title" style="color: white; font-size: 3rem; margin-bottom: 0.5rem;">Our Research Team</h2>
                    <p class="team-subtitle" style="color: rgba(255,255,255,0.9); font-size: 1.2rem; max-width: 800px; margin: 0 auto;">
                        Meet the talented developers and researchers behind Genomic Orchestra 2025
                    </p>
                </div>
            </div>
            <div class="team-modal-body">
                <div class="team-section">
                    <div class="team-grid" id="team-grid-modal">
                        <!-- Team members will be rendered here -->
                    </div>
                </div>
                <div style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 2px solid var(--bg-light);">
                    <button class="btn-wizard" onclick="closeTeamModal()" style="font-size: 1.2rem; padding: 1rem 3rem;">
                        <i class="fa-solid fa-arrow-right me-2"></i>Continue to Genomic Orchestra
                    </button>
                    <p style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                        Welcome to our platform for converting genomic sequences into musical compositions
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Species Details Modal -->
    <div class="modal fade" id="speciesModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="speciesModalTitle">Species Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="speciesModalBody">
                    <!-- Content will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div style="margin-bottom: 1.5rem;">
                <h4 style="font-size: 1.1rem; margin-bottom: 0.5rem; font-weight: 700;">Genomic Orchestra 2025</h4>
                <p style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Advanced Bioinformatics Research Platform</p>
                <p style="font-size: 0.85rem; opacity: 0.8;">Transforming Genetic Sequences into Musical Compositions | NCBI/Ensembl/UCSC Integration</p>
            </div>
            <div class="footer-links">
                <a href="#" class="footer-link"><i class="fa-solid fa-book me-1"></i>Documentation</a>
                <a href="#" class="footer-link"><i class="fa-solid fa-database me-1"></i>API Reference</a>
                <a href="#" class="footer-link"><i class="fa-solid fa-graduation-cap me-1"></i>Research Papers</a>
                <a href="#" class="footer-link"><i class="fa-solid fa-code me-1"></i>GitHub</a>
                <a href="#" class="footer-link"><i class="fa-solid fa-envelope me-1"></i>Contact</a>
                <a href="#" class="footer-link"><i class="fa-solid fa-shield-alt me-1"></i>Privacy Policy</a>
            </div>
            <div class="footer-copyright">
                <p class="mb-0">Â© 2025 Genomic Orchestra Research Platform. All rights reserved.</p>
                <p class="mb-0" style="margin-top: 0.5rem; font-size: 0.75rem;">Licensed for academic and research use. Data sources: NCBI, Ensembl, UCSC Genome Browser, GTDB.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- Authentication State ---
        let isLoggedIn = false;
        let currentUser = null;

        // --- State ---
        let currentStep = 0; 
        let maxStepReached = 0; 
        const totalSteps = 8; 
        
        // Enhanced Data - Professional Research Grade
        const phylogenies = [ 
            { 
                id: 1, 
                title: 'Mammalian Phylogeny', 
                description: 'Comprehensive phylogenetic tree including primates (Hominidae), rodents (Muridae), and carnivores (Carnivora). Based on NCBI Taxonomy database and recent genomic studies.',
                taxaCount: '5,416 species',
                reference: 'NCBI Taxonomy ID: 40674',
                lastUpdated: '2025-01-15'
            },
            { 
                id: 2, 
                title: 'Avian Phylogeny', 
                description: 'Complete avian evolutionary tree covering all major bird lineages. Includes Passeriformes, Galliformes, and Anseriformes based on whole-genome sequencing data.',
                taxaCount: '10,824 species',
                reference: 'NCBI Taxonomy ID: 8782',
                lastUpdated: '2025-01-12'
            },
            { 
                id: 3, 
                title: 'Marine Phylogeny', 
                description: 'Marine organism phylogeny encompassing teleost fish, marine mammals, and invertebrates. Includes data from Ocean Genome Legacy and marine genomics projects.',
                taxaCount: '32,156 species',
                reference: 'NCBI Taxonomy ID: 117570',
                lastUpdated: '2025-01-18'
            },
            { 
                id: 4, 
                title: 'Plant Phylogeny', 
                description: 'Angiosperm and gymnosperm phylogenetic relationships. Based on APG IV classification system and chloroplast genome analyses.',
                taxaCount: '374,000 species',
                reference: 'NCBI Taxonomy ID: 33090',
                lastUpdated: '2025-01-20'
            },
            { 
                id: 5, 
                title: 'Microbial Phylogeny', 
                description: 'Prokaryotic and archaeal phylogenetic tree. Includes 16S rRNA gene sequences and whole-genome phylogenomics from GTDB (Genome Taxonomy Database).',
                taxaCount: '1.2M+ species',
                reference: 'NCBI Taxonomy ID: 2',
                lastUpdated: '2025-01-22'
            }
        ];
        let currentCardIndex = 0;
        
        const speciesData = [ 
            { 
                id: 1, 
                name: 'Homo sapiens', 
                scientificName: 'Homo sapiens Linnaeus, 1758', 
                description: 'Modern humans - the only extant species of the genus Homo. Fully sequenced reference genome (GRCh38.p14) with 23 chromosome pairs.',
                habitat: 'Global distribution, terrestrial', 
                genomeSize: '3.2 Gb',
                chromosomeCount: '23 pairs (2n=46)',
                ncbiTaxId: '9606',
                assembly: 'GRCh38.p14',
                geneCount: '~20,000 protein-coding genes',
                publication: 'Nature 2022; Science 2023'
            },
            { 
                id: 2, 
                name: 'Mus musculus', 
                scientificName: 'Mus musculus Linnaeus, 1758', 
                description: 'House mouse - primary model organism for biomedical research. Well-annotated genome with extensive functional genomics data.',
                habitat: 'Cosmopolitan, synanthropic', 
                genomeSize: '2.8 Gb',
                chromosomeCount: '20 pairs (2n=40)',
                ncbiTaxId: '10090',
                assembly: 'GRCm39',
                geneCount: '~23,000 protein-coding genes',
                publication: 'Nature 2021; Cell 2024'
            },
            { 
                id: 3, 
                name: 'Canis lupus', 
                scientificName: 'Canis lupus Linnaeus, 1758', 
                description: 'Gray wolf - apex predator with high genetic diversity. Reference genome includes domestic dog (Canis lupus familiaris) variants.',
                habitat: 'Northern Hemisphere, diverse ecosystems', 
                genomeSize: '2.4 Gb',
                chromosomeCount: '39 pairs (2n=78)',
                ncbiTaxId: '9612',
                assembly: 'CanFam3.1',
                geneCount: '~19,000 protein-coding genes',
                publication: 'Genome Res 2023; PNAS 2024'
            },
            { 
                id: 4, 
                name: 'Felis catus', 
                scientificName: 'Felis catus Linnaeus, 1758', 
                description: 'Domestic cat - companion animal with high-quality reference genome. Important model for comparative genomics and disease studies.',
                habitat: 'Global, domesticated and feral populations', 
                genomeSize: '2.7 Gb',
                chromosomeCount: '19 pairs (2n=38)',
                ncbiTaxId: '9685',
                assembly: 'Felis_catus_9.0',
                geneCount: '~20,000 protein-coding genes',
                publication: 'GigaScience 2024; BMC Genomics 2023'
            },
            { 
                id: 5, 
                name: 'Gallus gallus', 
                scientificName: 'Gallus gallus (Linnaeus, 1758)', 
                description: 'Red junglefowl - ancestor of domestic chicken. First bird genome sequenced, important for avian genomics and agriculture.',
                habitat: 'Southeast Asia, tropical forests', 
                genomeSize: '1.2 Gb',
                chromosomeCount: '39 pairs (2n=78)',
                ncbiTaxId: '9031',
                assembly: 'GRCg7b',
                geneCount: '~17,000 protein-coding genes',
                publication: 'Nature 2004; Science 2020'
            },
            { 
                id: 6, 
                name: 'Danio rerio', 
                scientificName: 'Danio rerio (Hamilton, 1822)', 
                description: 'Zebrafish - premier vertebrate model for developmental biology and drug screening. Transparent embryos enable live imaging studies.',
                habitat: 'Freshwater, South Asian rivers', 
                genomeSize: '1.5 Gb',
                chromosomeCount: '25 pairs (2n=50)',
                ncbiTaxId: '7955',
                assembly: 'GRCz11',
                geneCount: '~26,000 protein-coding genes',
                publication: 'Nature 2013; Cell 2024'
            },
            { 
                id: 7, 
                name: 'Drosophila melanogaster', 
                scientificName: 'Drosophila melanogaster Meigen, 1830', 
                description: 'Fruit fly - foundational model organism in genetics. First multicellular organism with complete genome sequence.',
                habitat: 'Cosmopolitan, synanthropic', 
                genomeSize: '180 Mb',
                chromosomeCount: '4 pairs (2n=8)',
                ncbiTaxId: '7227',
                assembly: 'Release 6.54',
                geneCount: '~14,000 protein-coding genes',
                publication: 'Science 2000; Nature 2022'
            },
            { 
                id: 8, 
                name: 'Caenorhabditis elegans', 
                scientificName: 'Caenorhabditis elegans (Maupas, 1900)', 
                description: 'Nematode worm - first multicellular organism with complete genome sequence. Complete cell lineage and connectome mapped.',
                habitat: 'Temperate regions, soil and compost', 
                genomeSize: '100 Mb',
                chromosomeCount: '6 pairs (2n=12)',
                ncbiTaxId: '6239',
                assembly: 'WBcel235',
                geneCount: '~20,000 protein-coding genes',
                publication: 'Science 1998; Nature 2023'
            }
        ];
        let selectedSpeciesIds = [];
        let instrumentAssignments = {}; // { speciesId: [instrumentId1, instrumentId2, ...] }
        
        const instrumentsData = [
            { id: 'piano', name: 'Piano', icon: 'fa-solid fa-music', category: 'Keyboard' },
            { id: 'guitar', name: 'Guitar', icon: 'fa-solid fa-guitar', category: 'String' },
            { id: 'violin', name: 'Violin', icon: 'fa-solid fa-violin', category: 'String' },
            { id: 'cello', name: 'Cello', icon: 'fa-solid fa-music', category: 'String' },
            { id: 'drums', name: 'Drums', icon: 'fa-solid fa-drum', category: 'Percussion' },
            { id: 'flute', name: 'Flute', icon: 'fa-solid fa-music', category: 'Woodwind' },
            { id: 'trumpet', name: 'Trumpet', icon: 'fa-solid fa-music', category: 'Brass' },
            { id: 'saxophone', name: 'Saxophone', icon: 'fa-solid fa-music', category: 'Woodwind' },
            { id: 'harp', name: 'Harp', icon: 'fa-solid fa-music', category: 'String' },
            { id: 'organ', name: 'Organ', icon: 'fa-solid fa-music', category: 'Keyboard' },
            { id: 'clarinet', name: 'Clarinet', icon: 'fa-solid fa-music', category: 'Woodwind' },
            { id: 'bass', name: 'Bass', icon: 'fa-solid fa-music', category: 'String' }
        ];
        
        const genesData = [ 
            { 
                id: 1, 
                name: 'BRCA1', 
                seq: '[ ATG ] [ CGA ] [ TAC ] [ AGG ] [ GTC ] [ TAA ] [ CGC ] [ ATC ]', 
                description: 'BRCA1 DNA repair associated - Tumor suppressor gene involved in DNA double-strand break repair',
                fullName: 'BRCA1 DNA Repair Associated',
                chromosome: '17q21.31',
                geneId: '672',
                protein: 'BRCA1 (1863 aa)',
                function: 'DNA repair, cell cycle checkpoint, transcription regulation',
                diseases: 'Hereditary breast and ovarian cancer syndrome',
                ncbiRef: 'NM_007294.4'
            },
            { 
                id: 2, 
                name: 'TP53', 
                seq: '[ GGC ] [ ATC ] [ GGG ] [ TTA ] [ CGC ] [ ATG ] [ CGA ] [ TAC ]', 
                description: 'Tumor protein p53 - Master tumor suppressor regulating cell cycle, apoptosis, and DNA repair',
                fullName: 'Tumor Protein P53',
                chromosome: '17p13.1',
                geneId: '7157',
                protein: 'p53 (393 aa)',
                function: 'Transcription factor, tumor suppression, apoptosis induction',
                diseases: 'Li-Fraumeni syndrome, multiple cancers',
                ncbiRef: 'NM_000546.6'
            },
            { 
                id: 3, 
                name: 'CFTR', 
                seq: '[ TTT ] [ AAA ] [ CCC ] [ GGG ] [ TAC ] [ ATG ] [ CGA ] [ TAA ]', 
                description: 'Cystic fibrosis transmembrane conductance regulator - Chloride channel regulating ion transport',
                fullName: 'CFTR Anion Channel',
                chromosome: '7q31.2',
                geneId: '1080',
                protein: 'CFTR (1480 aa)',
                function: 'Chloride and bicarbonate transport, epithelial fluid secretion',
                diseases: 'Cystic fibrosis, congenital bilateral absence of vas deferens',
                ncbiRef: 'NM_000492.4'
            },
            { 
                id: 4, 
                name: 'HBB', 
                seq: '[ CTA ] [ GCT ] [ AGT ] [ CGT ] [ TGA ] [ ATG ] [ CGA ] [ TAC ]', 
                description: 'Hemoglobin subunit beta - Oxygen transport protein in red blood cells',
                fullName: 'Hemoglobin Subunit Beta',
                chromosome: '11p15.4',
                geneId: '3043',
                protein: 'Hemoglobin beta (147 aa)',
                function: 'Oxygen binding and transport, CO2 transport',
                diseases: 'Sickle cell disease, beta-thalassemia, hemoglobinopathies',
                ncbiRef: 'NM_000518.5'
            },
            { 
                id: 5, 
                name: 'INS', 
                seq: '[ ATG ] [ CGA ] [ TAC ] [ AGG ] [ GTC ] [ TAA ] [ CGC ] [ ATC ]', 
                description: 'Insulin - Hormone regulating glucose metabolism and energy homeostasis',
                fullName: 'Insulin',
                chromosome: '11p15.5',
                geneId: '3630',
                protein: 'Insulin (110 aa precursor)',
                function: 'Glucose uptake, glycogen synthesis, protein synthesis regulation',
                diseases: 'Type 1 diabetes, MODY, insulin resistance',
                ncbiRef: 'NM_000207.3'
            },
            { 
                id: 6, 
                name: 'APOE', 
                seq: '[ GGC ] [ ATC ] [ GGG ] [ TTA ] [ CGC ] [ ATG ] [ CGA ] [ TAC ]', 
                description: 'Apolipoprotein E - Lipid transport protein with major role in cholesterol metabolism',
                fullName: 'Apolipoprotein E',
                chromosome: '19q13.32',
                geneId: '348',
                protein: 'ApoE (317 aa)',
                function: 'Lipid transport, cholesterol homeostasis, neuronal repair',
                diseases: 'Alzheimer disease (APOE4 allele), hyperlipoproteinemia type III',
                ncbiRef: 'NM_000041.4'
            }
        ];
        let selectedGeneId = null;
        
        const scalesData = [ 
            { id: 'C', name: 'C Major' }, { id: 'G', name: 'G Major' }, 
            { id: 'D', name: 'D Major' }, { id: 'A', name: 'A Major' }, 
            { id: 'E', name: 'E Major' }, { id: 'B', name: 'B Major' }, 
            { id: 'F', name: 'F Major' }, { id: 'Bb', name: 'Bb Major' } 
        ];
        let selectedScaleId = null;
        
        const nucleotides = ['Adenine', 'Thymine', 'Guanine', 'Cytosine'];
        const aminoAcids = ['Polar', 'NonPolar', 'Acidic', 'Basic'];
        let configState = { 
            nucleotides: { Adenine: 'C', Thymine: 'D', Guanine: 'E', Cytosine: 'F' }, 
            aminoAcids: { Polar: 'Major', NonPolar: 'Minor', Acidic: 'Diminished', Basic: 'Augmented' } 
        };

        // Player Animation State
        let isPlaying = false;
        let animationFrame;
        let progress = 0;

        // --- Authentication Functions ---
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Demo mode - accept any credentials
            isLoggedIn = true;
            currentUser = { email: email, name: email.split('@')[0] };
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            updateAuthUI();
            navigateTo('home');
        }

        function handleLogout() {
            isLoggedIn = false;
            currentUser = null;
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
            updateAuthUI();
            navigateTo('login');
        }

        function checkAuth() {
            const stored = localStorage.getItem('isLoggedIn');
            if (stored === 'true') {
                isLoggedIn = true;
                currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            }
            updateAuthUI();
        }

        function checkAuthAndNavigate(viewId) {
            if (!isLoggedIn) {
                if (confirm('This feature requires login to save and analyze your compositions. Would you like to login now?')) {
                    navigateTo('login');
                }
                return;
            }
            navigateTo(viewId);
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('loginBtn');
            const userAvatar = document.getElementById('userAvatar');
            const navProfile = document.getElementById('navProfile');
            const navSavedLink = document.getElementById('navSavedLink');
            
            if (isLoggedIn) {
                loginBtn.style.display = 'none';
                userAvatar.style.display = 'flex';
                navProfile.style.display = 'block';
                if (navSavedLink) {
                    navSavedLink.style.opacity = '1';
                    navSavedLink.innerHTML = 'Saved';
                }
            } else {
                loginBtn.style.display = 'block';
                userAvatar.style.display = 'none';
                navProfile.style.display = 'none';
                if (navSavedLink) {
                    navSavedLink.style.opacity = '0.6';
                    navSavedLink.innerHTML = 'Saved (Login)';
                }
            }
        }

        function showProfileMenu() {
            if (confirm('Would you like to logout?')) {
                handleLogout();
            }
        }

        // --- Navigation ---
        function navigateTo(viewId) {
            document.querySelectorAll('.view-section').forEach(el => { 
                el.classList.remove('active');
                el.style.display = 'none';
            });
            
            const target = document.getElementById(`view-${viewId}`);
            if (target) {
                target.classList.add('active');
                target.style.display = 'flex';
            }

            const progressRing = document.getElementById('progressRing');
            const navLinks = document.getElementById('navLinksContainer');

            if (viewId === 'home') {
                currentStep = 0; 
                progressRing.style.display = 'none'; 
                if(navLinks) navLinks.style.opacity = '1';
                // Render team when navigating to home
                setTimeout(() => renderTeam(), 100);
            } else if (viewId.startsWith('create-step')) {
                const stepNum = parseInt(viewId.split('-').pop());
                currentStep = stepNum;
                if (currentStep > maxStepReached) maxStepReached = currentStep;

                progressRing.style.display = 'block';
                updateProgress(currentStep, totalSteps);
                if(navLinks) navLinks.style.opacity = '0'; 

                if (currentStep === 1) renderCarousel();
                if (currentStep === 2) renderSpecies();
                if (currentStep === 3) {
                    renderInstruments();
                    // Setup search functionality (only once)
                    setTimeout(() => {
                        const instrumentSearch = document.getElementById('instrumentSearch');
                        if (instrumentSearch && !instrumentSearch.dataset.listenerAttached) {
                            instrumentSearch.dataset.listenerAttached = 'true';
                            instrumentSearch.addEventListener('input', function() {
                                renderInstruments();
                            });
                        }
                    }, 100);
                }
                if (currentStep === 4) renderGenes();
                if (currentStep === 5) renderScales();
                if (currentStep === 6) renderConfig();
                if (currentStep === 7) renderSummary();
                if (currentStep === 8) renderPlayer(); 
            } else if (viewId === 'load') {
                currentStep = 0; 
                progressRing.style.display = 'none';
                renderSymphoniesList();
            } else if (viewId === 'login') {
                currentStep = 0;
                progressRing.style.display = 'none';
            }
            updateNavigationDropdown();
            updateAuthUI(); // Update UI based on login status
        }

        function updateNavigationDropdown() {
            const menu = document.getElementById('navDropdownMenu');
            menu.innerHTML = `<li class="nav-dropdown-item ${currentStep === 0 ? 'active-step' : ''}" onclick="navigateTo('home')"><span>Home</span> <i class="fa-solid fa-house"></i></li>`;
            const steps = [ 
                { num: 1, name: 'Phylogeny' }, { num: 2, name: 'Species' }, 
                { num: 3, name: 'Instruments' }, { num: 4, name: 'Genes' }, 
                { num: 5, name: 'Scale' }, { num: 6, name: 'Config' }, 
                { num: 7, name: 'Summary' }, { num: 8, name: 'Player' } 
            ];
            steps.forEach(s => {
                const isActive = (currentStep === s.num); 
                const isAccessible = (s.num <= maxStepReached);
                let itemClass = 'nav-dropdown-item'; 
                if (isActive) itemClass += ' active-step'; 
                if (!isAccessible) itemClass += ' disabled';
                const onClick = isAccessible ? `onclick="navigateTo('create-step-${s.num}')"` : '';
                const icon = isActive ? '<i class="fa-solid fa-location-dot"></i>' : (isAccessible ? '<i class="fa-solid fa-check text-success"></i>' : '<i class="fa-solid fa-lock"></i>');
                menu.innerHTML += `<li class="${itemClass}" ${onClick}><span>${s.name}</span>${icon}</li>`;
            });
        }

        function updateProgress(step, total) { 
            const circle = document.getElementById('progressCircle'); 
            const radius = circle.r.baseVal.value; 
            const circumference = radius * 2 * Math.PI; 
            circle.style.strokeDasharray = `${circumference} ${circumference}`; 
            circle.style.strokeDashoffset = circumference - ((step / total) * circumference); 
        }

        // --- Step 1: Carousel ---
        function renderCarousel() { 
            const container = document.getElementById('card-container'); 
            container.innerHTML = ''; 
            phylogenies.forEach((phylo, index) => { 
                const card = document.createElement('div'); 
                card.className = `phylo-card ${getCardClass(index)}`; 
                card.innerHTML = `
                    <h3 style="margin-bottom: 0.75rem;">${phylo.title}</h3>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 15px; line-height: 1.6;">${phylo.description}</p>
                    <div class="phylo-stats">
                        <div class="phylo-stat-item">
                            <div class="phylo-stat-label">Taxa</div>
                            <div class="phylo-stat-value">${phylo.taxaCount}</div>
                        </div>
                        <div class="phylo-stat-item">
                            <div class="phylo-stat-label">NCBI ID</div>
                            <div class="phylo-stat-value" style="font-size: 0.75rem;">${phylo.reference.split(': ')[1]}</div>
                        </div>
                        <div class="phylo-stat-item">
                            <div class="phylo-stat-label">Updated</div>
                            <div class="phylo-stat-value" style="font-size: 0.75rem;">${phylo.lastUpdated.split('-')[1]}/${phylo.lastUpdated.split('-')[2]}</div>
                        </div>
                    </div>
                    <div class="phylo-image-placeholder" style="margin-top: 15px;">
                        <i class="fa-solid fa-dna fa-3x" style="color: var(--accent-purple);"></i>
                    </div>
                `; 
                container.appendChild(card); 
            }); 
        }
        
        function getCardClass(index) { 
            if (index === currentCardIndex) return 'active'; 
            if (index === currentCardIndex - 1) return 'prev'; 
            if (index === currentCardIndex + 1) return 'next'; 
            return 'hidden'; 
        }
        
        function moveCarousel(dir) { 
            const next = currentCardIndex + dir; 
            if (next >= 0 && next < phylogenies.length) { 
                currentCardIndex = next; 
                renderCarousel(); 
            } 
        }

        // --- Step 2: Species ---
        function toggleSpeciesView(type) { 
            const grid = document.getElementById('species-grid'); 
            const list = document.getElementById('species-list'); 
            const btnCards = document.getElementById('toggle-cards-s2'); 
            const btnLists = document.getElementById('toggle-lists-s2'); 
            if (type === 'cards') { 
                grid.style.display = 'grid'; 
                list.style.display = 'none'; 
                btnCards.classList.add('active'); 
                btnLists.classList.remove('active'); 
            } else { 
                grid.style.display = 'none'; 
                list.style.display = 'flex'; 
                btnCards.classList.remove('active'); 
                btnLists.classList.add('active'); 
            } 
        }

        function renderSpecies() { 
            document.getElementById('species-grid').innerHTML = speciesData.map(s => { 
                const isSelected = selectedSpeciesIds.includes(s.id);
                return `
                    <div class="species-card-grid ${isSelected ? 'selected' : ''}" onclick="toggleSpeciesSelection(${s.id})">
                        <div class="img-box">
                            <i class="fa-solid fa-dna"></i>
                        </div>
                        <h5>${s.name}</h5>
                        <p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.5rem;"><em>${s.scientificName}</em></p>
                        <div class="info-badge" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">
                            <i class="fa-solid fa-database"></i>
                            <span>${s.assembly}</span>
                        </div>
                    </div>
                `;
            }).join(''); 
            
            document.getElementById('species-list-items').innerHTML = speciesData.map(s => { 
                const isSelected = selectedSpeciesIds.includes(s.id);
                return `
                    <div class="list-item">
                        <div class="list-item-left" onclick="toggleSpeciesSelection(${s.id})">
                            <div class="custom-checkbox ${isSelected ? 'checked' : ''}"></div>
                            <div>
                                <div>
                                    <h5 class="m-0">${s.name}</h5>
                                    <p class="m-0" style="font-size: 0.85rem; color: var(--text-secondary);"><em>${s.scientificName}</em></p>
                                    <div style="display: flex; gap: 0.5rem; margin-top: 0.25rem; flex-wrap: wrap;">
                                        <span class="info-badge" style="font-size: 0.7rem;">
                                            <i class="fa-solid fa-database"></i> ${s.assembly}
                                        </span>
                                        <span class="info-badge" style="font-size: 0.7rem;">
                                            <i class="fa-solid fa-chart-bar"></i> ${s.genomeSize}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button class="btn-view-details" onclick="showSpeciesDetails(${s.id}); event.stopPropagation();">View Details</button>
                    </div>
                `;
            }).join(''); 
        }

        function toggleSpeciesSelection(id) { 
            if (selectedSpeciesIds.includes(id)) {
                selectedSpeciesIds = selectedSpeciesIds.filter(itemId => itemId !== id);
                // Remove instrument assignment if species is deselected
                delete instrumentAssignments[id];
            } else {
                selectedSpeciesIds.push(id);
            }
            renderSpecies(); 
        }

        // --- Step 3: Instruments ---
        function renderInstruments() {
            const container = document.getElementById('instrument-assignment-container');
            const selectedSpecies = speciesData.filter(s => selectedSpeciesIds.includes(s.id));
            
            if (selectedSpecies.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <i class="fa-solid fa-info-circle" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>Please select at least one species in Step 2 before assigning instruments.</p>
                        <button class="btn-wizard mt-3" onclick="navigateTo('create-step-2')">
                            <i class="fa-solid fa-arrow-left me-2"></i>Go to Species Selection
                        </button>
                    </div>
                `;
                return;
            }

            // Get search term
            const searchInput = document.getElementById('instrumentSearch');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';

            container.innerHTML = `
                <div class="instrument-assignment-grid">
                    ${selectedSpecies.map(species => {
                        const selectedInstruments = instrumentAssignments[species.id] || [];
                        // Filter instruments based on search
                        const filteredInstruments = instrumentsData.filter(instrument => 
                            !searchTerm || 
                            instrument.name.toLowerCase().includes(searchTerm) ||
                            instrument.category.toLowerCase().includes(searchTerm)
                        );
                        return `
                            <div class="instrument-assignment-card">
                                <div class="instrument-species-header">
                                    <div class="instrument-species-icon">
                                        <i class="fa-solid fa-dna"></i>
                                    </div>
                                    <div class="instrument-species-info">
                                        <h4>${species.name}</h4>
                                        <p>${species.scientificName}</p>
                                    </div>
                                </div>
                                <div class="instrument-select-container">
                                    <label class="instrument-select-label">
                                        <i class="fa-solid fa-music me-2" style="color: var(--accent-purple);"></i>
                                        Select Instruments (Multiple Allowed)
                                    </label>
                                    <div class="instrument-grid">
                                        ${filteredInstruments.length > 0 ? filteredInstruments.map(instrument => {
                                            const isSelected = selectedInstruments.includes(instrument.id);
                                            return `
                                                <div class="instrument-option ${isSelected ? 'selected' : ''}" 
                                                     onclick="assignInstrument(${species.id}, '${instrument.id}')">
                                                    <i class="${instrument.icon}"></i>
                                                    <span>${instrument.name}</span>
                                                    ${isSelected ? '<i class="fa-solid fa-check" style="position: absolute; top: 5px; right: 5px; font-size: 0.8rem;"></i>' : ''}
                                                </div>
                                            `;
                                        }).join('') : `
                                            <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--text-secondary);">
                                                <i class="fa-solid fa-search" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                                                <p>No instruments found matching "${searchTerm}"</p>
                                            </div>
                                        `}
                                    </div>
                                    ${selectedInstruments.length > 0 ? `
                                        <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem; font-weight: 600;">
                                                Selected (${selectedInstruments.length}):
                                            </div>
                                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                                ${selectedInstruments.map(instrId => {
                                                    const instr = instrumentsData.find(i => i.id === instrId);
                                                    return instr ? `
                                                        <span style="display: inline-flex; align-items: center; gap: 0.4rem; background: var(--primary-gradient); color: white; padding: 0.4rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                                                            <i class="${instr.icon}"></i>
                                                            ${instr.name}
                                                        </span>
                                                    ` : '';
                                                }).join('')}
                                            </div>
                                        </div>
                                    ` : `
                                        <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; text-align: center; border: 1px solid rgba(239, 68, 68, 0.3);">
                                            <span style="font-size: 0.85rem; color: var(--error);">
                                                <i class="fa-solid fa-exclamation-circle me-1"></i>
                                                No instruments selected
                                            </span>
                                        </div>
                                    `}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function assignInstrument(speciesId, instrumentId) {
            // Initialize array if it doesn't exist
            if (!instrumentAssignments[speciesId]) {
                instrumentAssignments[speciesId] = [];
            }
            // Toggle instrument selection
            const index = instrumentAssignments[speciesId].indexOf(instrumentId);
            if (index > -1) {
                // Remove if already selected
                instrumentAssignments[speciesId].splice(index, 1);
            } else {
                // Add if not selected
                instrumentAssignments[speciesId].push(instrumentId);
            }
            renderInstruments();
        }

        function showSpeciesDetails(id) {
            const species = speciesData.find(s => s.id === id);
            if (!species) return;

            const modal = new bootstrap.Modal(document.getElementById('speciesModal'));
            document.getElementById('speciesModalTitle').innerHTML = `
                ${species.name}
                <span class="research-badge-large" style="margin-left: 1rem; font-size: 0.7rem;">
                    <i class="fa-solid fa-dna"></i> Reference Genome
                </span>
            `;
            document.getElementById('speciesModalBody').innerHTML = `
                <div class="research-header" style="margin-bottom: 1.5rem;">
                    <div style="flex: 1;">
                        <div class="species-detail-label" style="font-size: 0.75rem; margin-bottom: 0.5rem;">Scientific Classification (Full Binomial)</div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: var(--accent-purple); margin-bottom: 0.5rem;">
                            <em>${species.scientificName}</em>
                        </div>
                        <div class="data-source">
                            <i class="fa-solid fa-database me-1"></i>NCBI Taxonomy ID: 
                            <a href="https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id=${species.ncbiTaxId}" target="_blank" style="color: var(--accent-purple); text-decoration: none;">
                                ${species.ncbiTaxId}
                            </a>
                            <span class="research-badge" style="margin-left: 0.5rem; font-size: 0.65rem;">
                                <i class="fa-solid fa-check"></i> Verified 2025
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="species-detail-item">
                    <div class="species-detail-label"><i class="fa-solid fa-info-circle me-2"></i>Taxonomic & Biological Description</div>
                    <div style="line-height: 1.8; color: var(--text-primary);">${species.description}</div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                    <div class="species-detail-item" style="margin: 0;">
                        <div class="species-detail-label">Reference Assembly</div>
                        <div style="font-weight: 700; color: var(--accent-purple); font-size: 1.1rem; margin: 0.5rem 0;">${species.assembly}</div>
                        <div class="data-source">Latest Annotated Version (2025)</div>
                    </div>
                    <div class="species-detail-item" style="margin: 0;">
                        <div class="species-detail-label">Genome Size</div>
                        <div style="font-weight: 700; color: var(--accent-purple); font-size: 1.1rem; margin: 0.5rem 0;">${species.genomeSize}</div>
                        <div class="data-source">Total Base Pairs</div>
                    </div>
                    <div class="species-detail-item" style="margin: 0;">
                        <div class="species-detail-label">Chromosome Count</div>
                        <div style="font-weight: 700; color: var(--accent-purple); font-size: 1.1rem; margin: 0.5rem 0;">${species.chromosomeCount}</div>
                        <div class="data-source">Diploid Karyotype</div>
                    </div>
                    <div class="species-detail-item" style="margin: 0;">
                        <div class="species-detail-label">Protein-Coding Genes</div>
                        <div style="font-weight: 700; color: var(--accent-purple); font-size: 1.1rem; margin: 0.5rem 0;">${species.geneCount}</div>
                        <div class="data-source">Annotated Genes</div>
                    </div>
                </div>
                
                <div class="species-detail-item">
                    <div class="species-detail-label"><i class="fa-solid fa-globe me-2"></i>Ecological Distribution & Habitat</div>
                    <div style="line-height: 1.7;">${species.habitat}</div>
                </div>
                
                <div class="species-detail-item">
                    <div class="species-detail-label"><i class="fa-solid fa-book-open me-2"></i>Recent Genomic Publications & References</div>
                    <div style="font-size: 0.95rem; line-height: 1.8; margin-top: 0.5rem;">
                        <i class="fa-solid fa-quote-left me-1" style="color: var(--accent-purple); opacity: 0.5;"></i>
                        ${species.publication}
                    </div>
                    <div class="data-source" style="margin-top: 0.5rem;">Primary genome assembly and annotation references</div>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1.25rem; background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(20, 184, 166, 0.05) 100%); border-radius: 12px; border-left: 4px solid var(--accent-purple);">
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <i class="fa-solid fa-info-circle" style="color: var(--accent-purple); font-size: 1.2rem; margin-top: 0.2rem;"></i>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">Data Source & Verification</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.7;">
                                This species data is sourced from <strong>NCBI Genome Database</strong>, <strong>Ensembl</strong>, and <strong>UCSC Genome Browser</strong>. 
                                Assembly information is current as of <strong>January 2025</strong>. For the most up-to-date annotations, functional genomics data, 
                                and variant information, visit 
                                <a href="https://www.ncbi.nlm.nih.gov/genome" target="_blank" style="color: var(--accent-purple); text-decoration: none; font-weight: 600;">
                                    NCBI Genome <i class="fa-solid fa-external-link-alt" style="font-size: 0.7rem;"></i>
                                </a> or 
                                <a href="https://www.ensembl.org" target="_blank" style="color: var(--accent-purple); text-decoration: none; font-weight: 600;">
                                    Ensembl <i class="fa-solid fa-external-link-alt" style="font-size: 0.7rem;"></i>
                                </a>.
                            </div>
                        </div>
                    </div>
                </div>
            `;
            modal.show();
        }

        // --- Step 3: Genes ---
        function toggleGeneView(type) { 
            const grid = document.getElementById('gene-grid'); 
            const list = document.getElementById('gene-list'); 
            const btnCards = document.getElementById('toggle-cards-s3'); 
            const btnLists = document.getElementById('toggle-lists-s3'); 
            if (type === 'cards') { 
                grid.style.display = 'grid'; 
                list.style.display = 'none'; 
                btnCards.classList.add('active'); 
                btnLists.classList.remove('active'); 
            } else { 
                grid.style.display = 'none'; 
                list.style.display = 'flex'; 
                btnCards.classList.remove('active'); 
                btnLists.classList.add('active'); 
            } 
        }

        function renderGenes() { 
            document.getElementById('gene-grid').innerHTML = genesData.map(g => { 
                const isSelected = (selectedGeneId === g.id);
                return `
                    <div class="gene-card ${isSelected ? 'selected' : ''}" onclick="selectGene(${g.id})">
                        <div class="gene-title">${g.name} <span class="data-badge" style="font-size: 0.65rem; padding: 0.15rem 0.5rem;">${g.geneId}</span></div>
                        <div style="font-size: 0.75rem; color: var(--accent-purple); margin-bottom: 0.5rem; font-style: italic;">${g.fullName}</div>
                        <div class="gene-seq">${g.seq}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.75rem; line-height: 1.5;">${g.description}</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #e2e8f0; display: flex; gap: 1rem; flex-wrap: wrap;">
                            <span><i class="fa-solid fa-map-marker-alt" style="color: var(--accent-purple);"></i> <strong>Location:</strong> ${g.chromosome}</span>
                            <span><i class="fa-solid fa-dna" style="color: var(--accent-purple);"></i> <strong>Protein:</strong> ${g.protein}</span>
                        </div>
                    </div>
                `;
            }).join(''); 
            
            document.getElementById('gene-list').innerHTML = genesData.map(g => { 
                const isSelected = (selectedGeneId === g.id);
                return `
                    <div class="gene-list-item" onclick="selectGene(${g.id})">
                        <div class="custom-radio ${isSelected ? 'selected' : ''}"></div>
                        <div style="flex: 1;">
                            <div style="flex: 1;">
                                <div class="gene-list-name">
                                    ${g.name} 
                                    <span class="data-badge" style="font-size: 0.7rem; padding: 0.15rem 0.4rem; margin-left: 0.5rem;">ID: ${g.geneId}</span>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--accent-purple); margin-top: 0.25rem; font-style: italic;">${g.fullName}</div>
                                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem; line-height: 1.4;">${g.description}</div>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap;">
                                    <span class="info-badge" style="font-size: 0.75rem;">
                                        <i class="fa-solid fa-map-marker-alt"></i> ${g.chromosome}
                                    </span>
                                    <span class="info-badge" style="font-size: 0.75rem;">
                                        <i class="fa-solid fa-dna"></i> ${g.protein}
                                    </span>
                                    <span class="info-badge" style="font-size: 0.75rem;">
                                        <i class="fa-solid fa-database"></i> ${g.ncbiRef}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join(''); 
        }

        function selectGene(id) { 
            selectedGeneId = id; 
            renderGenes(); 
        }

        // --- Step 4: Scales ---
        function renderScales() { 
            document.getElementById('scale-grid').innerHTML = scalesData.map(scale => { 
                const isSelected = (selectedScaleId === scale.id);
                return `
                    <div class="scale-card ${isSelected ? 'selected' : ''}" onclick="selectScale('${scale.id}')">
                        <i class="fa-solid fa-music scale-icon"></i>
                        <div class="scale-name">${scale.name}</div>
                    </div>
                `;
            }).join(''); 
        }

        function selectScale(id) { 
            selectedScaleId = id; 
            renderScales(); 
        }

        // --- Step 5: Config ---
        function renderConfig() { 
            const notes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            const chords = ['Major', 'Minor', 'Diminished', 'Augmented', 'Sus2', 'Sus4'];
            
            document.getElementById('nucleotide-container').innerHTML = nucleotides.map(n => `
                <div class="config-row">
                    <span class="config-label">${n}</span>
                    <select class="config-select" onchange="configState.nucleotides['${n}'] = this.value">
                        ${notes.map(note => `<option value="${note}" ${configState.nucleotides[n] === note ? 'selected' : ''}>${note}</option>`).join('')}
                    </select>
                </div>
            `).join(''); 
            
            document.getElementById('amino-container').innerHTML = aminoAcids.map(a => `
                <div class="config-row">
                    <span class="config-label">${a}</span>
                    <select class="config-select" onchange="configState.aminoAcids['${a}'] = this.value">
                        ${chords.map(chord => `<option value="${chord}" ${configState.aminoAcids[a] === chord ? 'selected' : ''}>${chord}</option>`).join('')}
                    </select>
                </div>
            `).join(''); 
        }

        // --- Step 6: Summary ---
        function toggleSummaryView(type) { 
            const listContainer = document.getElementById('summary-content-list'); 
            const visualContainer = document.getElementById('summary-content-visual'); 
            const btnList = document.getElementById('toggle-sum-list'); 
            const btnVisual = document.getElementById('toggle-sum-visual'); 
            if (type === 'list') { 
                listContainer.style.display = 'flex'; 
                visualContainer.style.display = 'none'; 
                btnList.classList.add('active'); 
                btnVisual.classList.remove('active'); 
            } else { 
                listContainer.style.display = 'none'; 
                visualContainer.style.display = 'flex'; 
                btnList.classList.remove('active'); 
                btnVisual.classList.add('active'); 
            } 
        }

        function renderSummary() { 
            const phyloName = phylogenies[currentCardIndex].title; 
            const selectedSpecies = selectedSpeciesIds.length > 0 ? speciesData.filter(s => selectedSpeciesIds.includes(s.id)) : []; 
            const speciesNames = selectedSpecies.map(s => s.name).join(', ') || 'None selected'; 
            const geneObj = genesData.find(g => g.id === selectedGeneId); 
            const geneName = geneObj ? geneObj.name : 'None selected'; 
            const scaleObj = scalesData.find(s => s.id === selectedScaleId); 
            const scaleName = scaleObj ? scaleObj.name : 'None selected';
            
            // Build instrument assignments summary
            let instrumentsSummary = '';
            if (selectedSpecies.length > 0) {
                const instrumentList = selectedSpecies.map(s => {
                    const selectedInstrumentIds = instrumentAssignments[s.id] || [];
                    const selectedInstruments = selectedInstrumentIds.map(id => instrumentsData.find(i => i.id === id)).filter(Boolean);
                    if (selectedInstruments.length > 0) {
                        const instrumentNames = selectedInstruments.map(i => i.name).join(', ');
                        return `${s.name}: ${instrumentNames}`;
                    }
                    return `${s.name}: Not assigned`;
                }).join('; ');
                instrumentsSummary = `<p style="font-size:0.85rem; color:var(--text-secondary); margin-top:0.5rem;">${instrumentList}</p>`;
            }

            document.getElementById('summary-content-list').innerHTML = `
                <div class="summary-card">
                    <div class="summary-content">
                        <h4>Phylogeny</h4>
                        <p>${phyloName}</p>
                    </div>
                    <button class="btn-edit" onclick="navigateTo('create-step-1')">Edit</button>
                </div>
                <div class="summary-card">
                    <div class="summary-content">
                        <h4>Species</h4>
                        <p>${speciesNames}</p>
                    </div>
                    <button class="btn-edit" onclick="navigateTo('create-step-2')">Edit</button>
                </div>
                <div class="summary-card">
                    <div class="summary-content">
                        <h4>Instruments</h4>
                        <p>${selectedSpecies.length} species with assigned instruments</p>
                        ${instrumentsSummary}
                    </div>
                    <button class="btn-edit" onclick="navigateTo('create-step-3')">Edit</button>
                </div>
                <div class="summary-card">
                    <div class="summary-content">
                        <h4>Gene</h4>
                        <p>${geneName}</p>
                    </div>
                    <button class="btn-edit" onclick="navigateTo('create-step-4')">Edit</button>
                </div>
                <div class="summary-card">
                    <div class="summary-content">
                        <h4>Configuration</h4>
                        <p>Scale: ${scaleName}</p>
                        <p style="font-size:0.85rem; color:var(--text-secondary);">Nucleotides & Amino Acids configured</p>
                    </div>
                    <button class="btn-edit" onclick="navigateTo('create-step-6')">Edit</button>
                </div>
            `;
            
            let speciesHTML = selectedSpecies.length > 0 ? selectedSpecies.map(s => {
                const selectedInstrumentIds = instrumentAssignments[s.id] || [];
                const selectedInstruments = selectedInstrumentIds.map(id => instrumentsData.find(i => i.id === id)).filter(Boolean);
                return `
                    <div class="species-card-mini" style="position: relative;">
                        <div class="img-box-mini"><i class="fa-solid fa-dna"></i></div>
                        <span>${s.name}</span>
                        ${selectedInstruments.length > 0 ? `
                            <div style="position: absolute; top: -5px; right: -5px; background: var(--accent-purple); color: white; min-width: 24px; height: 24px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; padding: 0 6px; font-weight: 700;">
                                ${selectedInstruments.length}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('') : '<span class="text-muted">No Species</span>';
            
            let nucPills = Object.entries(configState.nucleotides).map(([base, note]) => `
                <div class="config-pill">
                    <div class="config-pill-circle">N</div>
                    ${base} â†’ ${note}
                </div>
            `).join('');
            
            let aminoPills = Object.entries(configState.aminoAcids).map(([type, chord]) => `
                <div class="config-pill">
                    <div class="config-pill-circle">A</div>
                    ${type} â†’ ${chord}
                </div>
            `).join('');
            
            document.getElementById('summary-content-visual').innerHTML = `
                <div class="summary-visual-section">
                    <div class="summary-visual-row">
                        <div class="summary-section-title">${phyloName}</div>
                        <div class="summary-items-grid">
                            ${speciesHTML}
                        </div>
                        <button class="btn-edit-square" onclick="navigateTo('create-step-1')">Edit</button>
                    </div>
                </div>
                <div class="summary-visual-section">
                    <div class="summary-visual-row">
                        <div class="summary-section-title">Instruments</div>
                        <div class="summary-items-grid">
                            ${selectedSpecies.map(s => {
                                const selectedInstrumentIds = instrumentAssignments[s.id] || [];
                                const selectedInstruments = selectedInstrumentIds.map(id => instrumentsData.find(i => i.id === id)).filter(Boolean);
                                if (selectedInstruments.length > 0) {
                                    return selectedInstruments.map(instrument => `
                                        <div class="config-pill">
                                            <div class="config-pill-circle"><i class="${instrument.icon}" style="font-size: 0.7rem;"></i></div>
                                            ${s.name}: ${instrument.name}
                                        </div>
                                    `).join('');
                                }
                                return '';
                            }).filter(Boolean).join('') || '<span class="text-muted">No instruments assigned</span>'}
                        </div>
                        <button class="btn-edit-square" onclick="navigateTo('create-step-3')">Edit</button>
                    </div>
                </div>
                <div class="summary-visual-section" style="border-bottom:none;">
                    <div class="summary-visual-row">
                        <div class="summary-section-title">${geneName}</div>
                        <div class="summary-items-grid">
                            ${nucPills}
                            ${aminoPills}
                        </div>
                        <button class="btn-edit-square" onclick="navigateTo('create-step-6')">Edit</button>
                    </div>
                </div>
            `;
        }

        function saveAndNavigateToPlayer() {
            // Validate that all selected species have at least one instrument assigned
            const unassignedSpecies = selectedSpeciesIds.filter(id => {
                const instruments = instrumentAssignments[id] || [];
                return instruments.length === 0;
            });
            if (unassignedSpecies.length > 0) {
                const unassignedNames = unassignedSpecies.map(id => {
                    const species = speciesData.find(s => s.id === id);
                    return species ? species.name : 'Unknown';
                }).join(', ');
                alert(`Please assign at least one instrument to all selected species:\n${unassignedNames}`);
                navigateTo('create-step-3');
                return;
            }
            navigateTo('create-step-8');
        }

        // --- Symphony Storage ---
        function saveSymphony() {
            if (!isLoggedIn) {
                if (confirm('Save your composition for analysis? This requires login to store your work in the research library.')) {
                    navigateTo('login');
                }
                return;
            }

            const symphony = {
                id: Date.now(),
                name: `Genomic Composition ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}`,
                date: new Date().toISOString(),
                phylogeny: phylogenies[currentCardIndex],
                species: speciesData.filter(s => selectedSpeciesIds.includes(s.id)),
                instruments: instrumentAssignments,
                gene: genesData.find(g => g.id === selectedGeneId),
                scale: scalesData.find(s => s.id === selectedScaleId),
                config: configState,
                version: '2025.1',
                algorithm: 'Nucleotide-to-Note Translation v2.0'
            };

            let symphonies = JSON.parse(localStorage.getItem('symphonies') || '[]');
            symphonies.push(symphony);
            localStorage.setItem('symphonies', JSON.stringify(symphonies));
            
            alert('Composition saved successfully to your research library!');
        }

        function renderSymphoniesList() {
            const container = document.getElementById('symphonies-list');
            
            if (!isLoggedIn) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fa-solid fa-lock" style="color: var(--accent-purple);"></i>
                        <h3>Login Required</h3>
                        <p>Please login to access your saved research compositions and analysis tools.</p>
                        <button class="btn-wizard mt-3" onclick="navigateTo('login')">
                            <i class="fa-solid fa-sign-in-alt me-2"></i>Login to Continue
                        </button>
                        <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-secondary);">
                            You can still create and play symphonies without logging in!
                        </p>
                        <button class="btn-wizard mt-2" onclick="navigateTo('create-step-1')" style="background: var(--bg-light); color: var(--accent-purple); border: 2px solid var(--accent-purple);">
                            <i class="fa-solid fa-music me-2"></i>Create Symphony (No Login)
                        </button>
                    </div>
                `;
                return;
            }
            
            const symphonies = JSON.parse(localStorage.getItem('symphonies') || '[]');

            if (symphonies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fa-solid fa-flask"></i>
                        <h3>No Research Compositions</h3>
                        <p>Begin your first genomic-to-musical translation project. Select a phylogenetic framework, species, and gene sequences to create a composition.</p>
                        <button class="btn-wizard mt-3" onclick="navigateTo('create-step-1')">
                            <i class="fa-solid fa-plus me-2"></i>Create New Composition
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = symphonies.map(s => {
                const date = new Date(s.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const time = new Date(s.date).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                return `
                    <div class="symphony-card">
                        <div class="symphony-header">
                            <div>
                                <div class="symphony-title">${s.name}</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                    <span class="data-badge" style="font-size: 0.65rem; padding: 0.15rem 0.5rem;">v${s.version || '2025.1'}</span>
                                    <span style="margin-left: 0.5rem;">Algorithm: ${s.algorithm || 'Nucleotide-to-Note Translation v2.0'}</span>
                                </div>
                            </div>
                            <div class="symphony-meta">
                                <div><i class="fa-solid fa-calendar"></i> ${date}</div>
                                <div style="font-size: 0.85rem; margin-top: 0.25rem;"><i class="fa-solid fa-clock"></i> ${time}</div>
                            </div>
                        </div>
                        <div class="symphony-info">
                            <div class="symphony-info-item">
                                <i class="fa-solid fa-dna"></i>
                                <span><strong>Phylogeny:</strong> ${s.phylogeny.title}</span>
                            </div>
                            <div class="symphony-info-item">
                                <i class="fa-solid fa-list"></i>
                                <span><strong>Species Count:</strong> ${s.species.length}</span>
                            </div>
                            <div class="symphony-info-item">
                                <i class="fa-solid fa-gene"></i>
                                <span><strong>Gene:</strong> ${s.gene ? s.gene.name + ' (' + s.gene.chromosome + ')' : 'N/A'}</span>
                            </div>
                            <div class="symphony-info-item">
                                <i class="fa-solid fa-music"></i>
                                <span><strong>Scale:</strong> ${s.scale ? s.scale.name : 'N/A'}</span>
                            </div>
                            <div class="symphony-info-item">
                                <i class="fa-solid fa-guitar"></i>
                                <span><strong>Instruments:</strong> ${s.instruments ? Object.values(s.instruments).reduce((total, instruments) => {
                                    const count = Array.isArray(instruments) ? instruments.length : (instruments ? 1 : 0);
                                    return total + count;
                                }, 0) : 0} total across ${s.instruments ? Object.keys(s.instruments).length : 0} species</span>
                            </div>
                            <div class="symphony-info-item">
                                <i class="fa-solid fa-cog"></i>
                                <span><strong>Mapping:</strong> Nucleotides & Amino Acids</span>
                            </div>
                        </div>
                        <div class="symphony-actions">
                            <button class="btn-symphony btn-load" onclick="loadSymphony(${s.id})">
                                <i class="fa-solid fa-play"></i> Load & Play
                            </button>
                            <button class="btn-symphony btn-delete" onclick="deleteSymphony(${s.id})">
                                <i class="fa-solid fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadSymphony(id) {
            const symphonies = JSON.parse(localStorage.getItem('symphonies') || '[]');
            const symphony = symphonies.find(s => s.id === id);
            if (!symphony) return;

            // Restore state
            currentCardIndex = phylogenies.findIndex(p => p.id === symphony.phylogeny.id);
            selectedSpeciesIds = symphony.species.map(s => s.id);
            // Handle both old format (single instrument) and new format (array of instruments)
            instrumentAssignments = {};
            if (symphony.instruments) {
                Object.keys(symphony.instruments).forEach(speciesId => {
                    const instruments = symphony.instruments[speciesId];
                    // If it's already an array, use it; if it's a single value, convert to array
                    instrumentAssignments[speciesId] = Array.isArray(instruments) ? instruments : [instruments];
                });
            }
            selectedGeneId = symphony.gene ? symphony.gene.id : null;
            selectedScaleId = symphony.scale ? symphony.scale.id : null;
            configState = symphony.config;

            maxStepReached = 8;
            navigateTo('create-step-8');
        }

        function deleteSymphony(id) {
            if (!confirm('Are you sure you want to delete this symphony?')) return;
            
            let symphonies = JSON.parse(localStorage.getItem('symphonies') || '[]');
            symphonies = symphonies.filter(s => s.id !== id);
            localStorage.setItem('symphonies', JSON.stringify(symphonies));
            renderSymphoniesList();
        }

        // --- PLAYER LOGIC ---
        function renderPlayer() {
            const wrapper = document.getElementById('tracks-wrapper');
            wrapper.innerHTML = '';
            
            const selectedSpecies = speciesData.filter(s => selectedSpeciesIds.includes(s.id));
            
            // Update save/load button visibility based on login status
            const saveBtn = document.getElementById('saveSymphonyBtn');
            const loadBtn = document.getElementById('loadSymphonyBtn');
            const saveNote = document.getElementById('saveSymphonyNote');
            const loadNote = document.getElementById('loadSymphonyNote');
            
            if (saveBtn && loadBtn) {
                if (!isLoggedIn) {
                    saveBtn.style.opacity = '0.7';
                    loadBtn.style.opacity = '0.7';
                    if (saveNote) saveNote.style.display = 'block';
                    if (loadNote) loadNote.style.display = 'block';
                } else {
                    saveBtn.style.opacity = '1';
                    loadBtn.style.opacity = '1';
                    if (saveNote) saveNote.style.display = 'none';
                    if (loadNote) loadNote.style.display = 'none';
                }
            }
            
            if (selectedSpecies.length === 0) {
                wrapper.innerHTML = '<p class="text-center text-muted">No species selected to play.</p>';
                return;
            }

            selectedSpecies.forEach((species, index) => {
                let notesHTML = '';
                for(let i = 0; i < 15; i++) {
                    const leftPos = Math.random() * 90;
                    const width = 5 + Math.random() * 10;
                    const topPos = 10 + Math.random() * 50; 
                    notesHTML += `<div class="note-block" style="left: ${leftPos}%; width: ${width}%; top: ${topPos}px;"></div>`;
                }

                const selectedInstrumentIds = instrumentAssignments[species.id] || [];
                const selectedInstruments = selectedInstrumentIds.map(id => instrumentsData.find(i => i.id === id)).filter(Boolean);

                wrapper.innerHTML += `
                    <div class="track-row">
                        <div class="track-info">
                            <div class="track-img"><i class="fa-solid fa-dna text-white"></i></div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">${species.name}</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">${species.scientificName}</div>
                                ${selectedInstruments.length > 0 ? `
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.5rem;">
                                        ${selectedInstruments.map(instrument => `
                                            <div class="track-instrument-badge" style="font-size: 0.75rem; padding: 0.3rem 0.6rem;">
                                                <i class="${instrument.icon}"></i>
                                                <span>${instrument.name}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="track-timeline">
                            <div class="track-lines"></div>
                            ${notesHTML}
                        </div>
                    </div>
                `;
            });
            stopAnimation();
        }

        function togglePlay() {
            if (isPlaying) { 
                stopAnimation(); 
            } else { 
                startAnimation(); 
            }
        }

        function startAnimation() {
            isPlaying = true;
            document.getElementById('playIcon').className = 'fa-solid fa-pause me-2';
            document.getElementById('playText').innerText = 'Pause Symphony';
            
            const playhead = document.getElementById('playhead');
            playhead.style.display = 'block';

            function animate() {
                if (!isPlaying) return;
                progress += 0.2; 
                if (progress > 100) progress = 0;
                
                playhead.style.left = `${progress}%`;
                
                document.querySelectorAll('.note-block').forEach(note => {
                    const noteLeftPerc = parseFloat(note.style.left);
                    const noteWidthPerc = parseFloat(note.style.width);
                    if (progress >= noteLeftPerc && progress <= (noteLeftPerc + noteWidthPerc)) {
                        note.classList.add('playing');
                    } else {
                        note.classList.remove('playing');
                    }
                });
                animationFrame = requestAnimationFrame(animate);
            }
            animate();
        }

        function stopAnimation() {  
            isPlaying = false;
            cancelAnimationFrame(animationFrame);
            document.getElementById('playIcon').className = 'fa-solid fa-play me-2';
            document.getElementById('playText').innerText = 'Play Symphony';
            document.querySelectorAll('.note-block').forEach(n => n.classList.remove('playing'));
            const playhead = document.getElementById('playhead');
            playhead.style.display = 'none';
            progress = 0;
        }

        // Team Members Data
        const teamMembers = [
            { name: 'Victoria Dao', image: 'Victoria.png', role: 'Developer & Researcher', icon: 'fa-solid fa-code' },
            { name: 'Naeem Richardson', image: 'Naeem.png', role: 'Developer & Researcher', icon: 'fa-solid fa-dna' },
            { name: 'Kib Arowrowon', image: 'Kib.png', role: 'Developer & Researcher', icon: 'fa-solid fa-music' },
            { name: 'Hansel Do', image: 'Hansel.png', role: 'Developer & Researcher', icon: 'fa-solid fa-flask' },
            { name: 'Fudayl Hopkins', image: 'Fudayl.png', role: 'Developer & Researcher', icon: 'fa-solid fa-chart-line' },
            { name: 'Sri Gadicherla', image: 'Sri.png', role: 'Developer & Researcher', icon: 'fa-solid fa-database' },
            { name: 'Henry Tran', image: 'Henry.png', role: 'Developer & Researcher', icon: 'fa-solid fa-microscope' },
            { name: 'Zain Akhtar', image: 'Zain.png', role: 'Developer & Researcher', icon: 'fa-solid fa-graduation-cap' }
        ];

        // Render Team Section
        function renderTeam(containerId = 'team-grid-modal') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = teamMembers.map((member, index) => {
                const initials = member.name.split(' ').map(n => n[0]).join('');
                return `
                    <div class="team-card" style="animation: fadeInUp 0.6s ease ${index * 0.1}s both;" 
                         onclick="showTeamMemberInfo('${member.name}', '${member.role}')"
                         onmouseenter="playTeamHoverSound(${index})">
                        <div class="team-image-container">
                            <img src="${member.image}" alt="${member.name}" class="team-image" 
                                 onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22140%22 height=%22140%22%3E%3Crect fill=%22%23667eea%22 width=%22140%22 height=%22140%22 rx=%2270%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.35em%22 fill=%22white%22 font-size=%2248%22 font-weight=%22bold%22%3E${initials}%3C/text%3E%3C/svg%3E';">
                        </div>
                        <h3 class="team-name">${member.name}</h3>
                        <p class="team-role">${member.role}</p>
                        <div class="team-overlay">
                            <div class="team-overlay-content">
                                <i class="${member.icon}"></i>
                                <h4>${member.name}</h4>
                                <p>${member.role}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showTeamMemberInfo(name, role) {
            // Optional: Add modal or tooltip functionality
            console.log(`Team member: ${name} - ${role}`);
        }

        function playTeamHoverSound(index) {
            // Optional: Add subtle sound effects on hover
        }

        // Team Modal Functions
        function closeTeamModal() {
            const modal = document.getElementById('teamModal');
            if (modal) {
                modal.classList.add('hidden');
                // Store that modal has been shown
                localStorage.setItem('teamModalShown', 'true');
                // Navigate to home page after modal closes
                setTimeout(() => {
                    navigateTo('home');
                    // Show home page team section
                    setTimeout(() => {
                        const homeTeamSection = document.querySelector('#view-home .team-section');
                        if (homeTeamSection) {
                            homeTeamSection.style.display = 'block';
                            renderTeam('team-grid-home');
                        }
                    }, 100);
                }, 500);
            }
        }

        function showTeamModal() {
            const modal = document.getElementById('teamModal');
            const hasBeenShown = localStorage.getItem('teamModalShown');
            
            if (modal && !hasBeenShown) {
                modal.classList.remove('hidden');
                renderTeam('team-grid-modal');
            } else if (hasBeenShown) {
                // If already shown, render team on home page directly
                const homeTeamSection = document.querySelector('#view-home .team-section');
                if (homeTeamSection) {
                    homeTeamSection.style.display = 'block';
                    renderTeam('team-grid-home');
                }
            }
        }

        // Initialize
        checkAuth();
        renderSpecies(); 
        renderGenes();
        
        // Show team modal on first visit, then navigate to home
        if (!localStorage.getItem('teamModalShown')) {
            showTeamModal();
            // Don't navigate to home yet - wait for modal close
        } else {
            // If modal already shown, go to home and show team section
            navigateTo('home');
            setTimeout(() => {
                const homeTeamSection = document.querySelector('#view-home .team-section');
                if (homeTeamSection) {
                    homeTeamSection.style.display = 'block';
                    renderTeam('team-grid-home');
                }
            }, 100);
        }
        
        // Allow closing modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('teamModal');
                if (modal && !modal.classList.contains('hidden')) {
                    closeTeamModal();
                    navigateTo('home');
                }
            }
        });
    </script>
</body>
</html>
